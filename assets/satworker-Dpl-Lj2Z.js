(function(){"use strict";var Wt=Math.PI,at=Wt*2,$e=Wt/180,hn=180/Wt,on=1440,ln=398600.8,Vt=6378.135,pe=60/Math.sqrt(Vt*Vt*Vt/ln),ps=Vt*pe/60,cn=1/pe,Oe=.001082616,un=-253881e-11,dn=-165597e-11,Ne=un/Oe,gi=2/3,mn=1440/(2*Wt);function fn(n,t){for(var e=[31,n%4===0?29:28,31,30,31,30,31,31,30,31,30,31],i=Math.floor(t),s=1,r=0;i>r+e[s-1]&&s<12;)r+=e[s-1],s+=1;var a=s,h=i-r,o=(t-i)*24,l=Math.floor(o);o=(o-l)*60;var c=Math.floor(o),d=(o-c)*60;return{mon:a,day:h,hr:l,minute:c,sec:d}}function lr(n,t,e,i,s,r){var a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;return 367*n-Math.floor(7*(n+Math.floor((t+9)/12))*.25)+Math.floor(275*t/9)+e+17210135e-1+((a/6e4+r/60+s)/60+i)/24}function xs(n,t,e,i,s,r){var a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;if(n instanceof Date){var h=n;return lr(h.getUTCFullYear(),h.getUTCMonth()+1,h.getUTCDate(),h.getUTCHours(),h.getUTCMinutes(),h.getUTCSeconds(),h.getUTCMilliseconds())}return lr(n,t,e,i,s,r,a)}function cr(n,t){var e=n.e3,i=n.ee2,s=n.peo,r=n.pgho,a=n.pho,h=n.pinco,o=n.plo,l=n.se2,c=n.se3,d=n.sgh2,m=n.sgh3,f=n.sgh4,p=n.sh2,x=n.sh3,M=n.si2,y=n.si3,S=n.sl2,C=n.sl3,w=n.sl4,A=n.t,z=n.xgh2,v=n.xgh3,b=n.xgh4,F=n.xh2,D=n.xh3,B=n.xi2,T=n.xi3,E=n.xl2,N=n.xl3,W=n.xl4,I=n.zmol,G=n.zmos,Y=t.init,V=t.opsmode,st=t.ep,U=t.inclp,P=t.nodep,Ct=t.argpp,ft=t.mp,O,k,ot,j,nt,Z,Dt,lt,pt,X,$,ct,J,L,Q,q,H,it,ht,K,rt,zt=119459e-10,xt=.01675,bt=.00015835218,_t=.0549;rt=G+zt*A,Y==="y"&&(rt=G),K=rt+2*xt*Math.sin(rt),H=Math.sin(K),X=.5*H*H-.25,$=-.5*H*Math.cos(K);var Ut=l*X+c*$,Lt=M*X+y*$,u=S*X+C*$+w*H,yt=d*X+m*$+f*H,dt=p*X+x*$;rt=I+bt*A,Y==="y"&&(rt=I),K=rt+2*_t*Math.sin(rt),H=Math.sin(K),X=.5*H*H-.25,$=-.5*H*Math.cos(K);var Ht=i*X+e*$,Ot=B*X+T*$,ut=E*X+N*$+W*H,wt=z*X+v*$+b*H,ce=F*X+D*$;return ct=Ut+Ht,Q=Lt+Ot,q=u+ut,J=yt+wt,L=dt+ce,Y==="n"&&(ct-=s,Q-=h,q-=o,J-=r,L-=a,U+=Q,st+=ct,j=Math.sin(U),ot=Math.cos(U),U>=.2?(L/=j,J-=ot*L,Ct+=J,P+=L,ft+=q):(Z=Math.sin(P),nt=Math.cos(P),O=j*Z,k=j*nt,Dt=L*nt+Q*ot*Z,lt=-L*Z+Q*ot*nt,O+=Dt,k+=lt,P%=at,P<0&&V==="a"&&(P+=at),it=ft+Ct+ot*P,pt=q+J-Q*P*j,it+=pt,ht=P,P=Math.atan2(O,k),P<0&&V==="a"&&(P+=at),Math.abs(ht-P)>Wt&&(P<ht?P+=at:P-=at),ft+=q,Ct=it-ft-ot*P)),{ep:st,inclp:U,nodep:P,argpp:Ct,mp:ft}}function pn(n){var t=n.epoch,e=n.ep,i=n.argpp,s=n.tc,r=n.inclp,a=n.nodep,h=n.np,o,l,c,d,m,f,p,x,M,y,S,C,w,A,z,v,b,F,D,B,T,E,N,W,I,G,Y,V,st,U,P,Ct,ft,O,k,ot,j,nt,Z,Dt,lt,pt,X,$,ct,J,L,Q,q,H,it,ht,K,rt,zt,xt,bt,_t,Ut,Lt,u,yt,dt,Ht=.01675,Ot=.0549,ut=29864797e-13,wt=47968065e-14,ce=.39785416,Rt=.91744867,vt=.1945905,ve=-.98088458,Gt=h,ue=e,te=Math.sin(a),ee=Math.cos(a),Bt=Math.sin(i),kt=Math.cos(i),ie=Math.sin(r),de=Math.cos(r),_=ue*ue,se=1-_,jt=Math.sqrt(se),Ze=0,tt=0,fi=0,Ii=0,Di=0,Ae=t+18261.5+s/1440,me=(4.523602-.00092422029*Ae)%at,St=Math.sin(me),re=Math.cos(me),pi=.91375164-.03568096*re,xi=Math.sqrt(1-pi*pi),Nt=.089683511*St/xi,qt=Math.sqrt(1-Nt*Nt),mt=5.8351514+.001944368*Ae,Xe=.39785416*St/xi,Hs=qt*re+.91744867*Nt*St;Xe=Math.atan2(Xe,Hs),Xe+=mt-me;var Gs=Math.cos(Xe),js=Math.sin(Xe);B=vt,T=ve,W=Rt,I=ce,E=ee,N=te,S=ut;for(var Qs=1/Gt,Oi=0;Oi<2;)Oi+=1,o=B*E+T*W*N,c=-T*E+B*W*N,p=-B*N+T*W*E,x=T*I,M=T*N+B*W*E,y=B*I,l=de*p+ie*x,d=de*M+ie*y,m=-ie*p+de*x,f=-ie*M+de*y,C=o*kt+l*Bt,w=c*kt+d*Bt,A=-o*Bt+l*kt,z=-c*Bt+d*kt,v=m*Bt,b=f*Bt,F=m*kt,D=f*kt,u=12*C*C-3*A*A,yt=24*C*w-6*A*z,dt=12*w*w-3*z*z,ht=3*(o*o+l*l)+u*_,K=6*(o*c+l*d)+yt*_,rt=3*(c*c+d*d)+dt*_,zt=-6*o*m+_*(-24*C*F-6*A*v),xt=-6*(o*f+c*m)+_*(-24*(w*F+C*D)+-6*(A*b+z*v)),bt=-6*c*f+_*(-24*w*D-6*z*b),_t=6*l*m+_*(24*C*v-6*A*F),Ut=6*(d*m+l*f)+_*(24*(w*v+C*b)-6*(z*F+A*D)),Lt=6*d*f+_*(24*w*b-6*z*D),ht=ht+ht+se*u,K=K+K+se*yt,rt=rt+rt+se*dt,L=S*Qs,J=-.5*L/jt,Q=L*jt,ct=-15*ue*Q,q=C*A+w*z,H=w*A+C*z,it=w*z-C*A,Oi===1&&(G=ct,Y=J,V=L,st=Q,U=q,P=H,Ct=it,ft=ht,O=K,k=rt,ot=zt,j=xt,nt=bt,Z=_t,Dt=Ut,lt=Lt,pt=u,X=yt,$=dt,B=Gs,T=js,W=pi,I=xi,E=qt*ee+Nt*te,N=te*qt-ee*Nt,S=wt);var Ni=(4.7199672+(.2299715*Ae-mt))%at,Ks=(6.2565837+.017201977*Ae)%at,tr=2*G*P,Ye=2*G*Ct,Je=2*Y*j,er=2*Y*(nt-ot),ir=-2*V*O,sr=-2*V*(k-ft),rr=-2*V*(-21-9*_)*Ht,yi=2*st*X,nr=2*st*($-pt),ar=-18*st*Ht,qi=-2*Y*Dt,fs=-2*Y*(lt-Z),Pi=2*ct*H,hr=2*ct*it,or=2*J*xt,ca=2*J*(bt-zt),ua=-2*L*K,da=-2*L*(rt-ht),ma=-2*L*(-21-9*_)*Ot,fa=2*Q*yt,pa=2*Q*(dt-u),xa=-18*Q*Ot,ya=-2*J*Ut,ga=-2*J*(Lt-_t);return{snodm:te,cnodm:ee,sinim:ie,cosim:de,sinomm:Bt,cosomm:kt,day:Ae,e3:hr,ee2:Pi,em:ue,emsq:_,gam:mt,peo:Ze,pgho:Ii,pho:Di,pinco:tt,plo:fi,rtemsq:jt,se2:tr,se3:Ye,sgh2:yi,sgh3:nr,sgh4:ar,sh2:qi,sh3:fs,si2:Je,si3:er,sl2:ir,sl3:sr,sl4:rr,s1:ct,s2:J,s3:L,s4:Q,s5:q,s6:H,s7:it,ss1:G,ss2:Y,ss3:V,ss4:st,ss5:U,ss6:P,ss7:Ct,sz1:ft,sz2:O,sz3:k,sz11:ot,sz12:j,sz13:nt,sz21:Z,sz22:Dt,sz23:lt,sz31:pt,sz32:X,sz33:$,xgh2:fa,xgh3:pa,xgh4:xa,xh2:ya,xh3:ga,xi2:or,xi3:ca,xl2:ua,xl3:da,xl4:ma,nm:Gt,z1:ht,z2:K,z3:rt,z11:zt,z12:xt,z13:bt,z21:_t,z22:Ut,z23:Lt,z31:u,z32:yt,z33:dt,zmol:Ni,zmos:Ks}}function xn(n){var t=n.cosim,e=n.argpo,i=n.s1,s=n.s2,r=n.s3,a=n.s4,h=n.s5,o=n.sinim,l=n.ss1,c=n.ss2,d=n.ss3,m=n.ss4,f=n.ss5,p=n.sz1,x=n.sz3,M=n.sz11,y=n.sz13,S=n.sz21,C=n.sz23,w=n.sz31,A=n.sz33,z=n.t,v=n.tc,b=n.gsto,F=n.mo,D=n.mdot,B=n.no,T=n.nodeo,E=n.nodedot,N=n.xpidot,W=n.z1,I=n.z3,G=n.z11,Y=n.z13,V=n.z21,st=n.z23,U=n.z31,P=n.z33,Ct=n.ecco,ft=n.eccsq,O=n.emsq,k=n.em,ot=n.argpm,j=n.inclm,nt=n.mm,Z=n.nm,Dt=n.nodem,lt=n.irez,pt=n.atime,X=n.d2201,$=n.d2211,ct=n.d3210,J=n.d3222,L=n.d4410,Q=n.d4422,q=n.d5220,H=n.d5232,it=n.d5421,ht=n.d5433,K=n.dedt,rt=n.didt,zt=n.dmdt,xt=n.dnodt,bt=n.domdt,_t=n.del1,Ut=n.del2,Lt=n.del3,u=n.xfact,yt=n.xlamo,dt=n.xli,Ht=n.xni,Ot,ut,wt,ce,Rt,vt,ve,Gt,ue,te,ee,Bt,kt,ie,de,_,se,jt,Ze,tt,fi,Ii,Di,Ae,me,St,re,pi,xi,Nt,qt,mt,Xe=17891679e-13,Hs=21460748e-13,Gs=22123015e-14,js=17891679e-13,Qs=73636953e-16,Oi=21765803e-16,Ni=.0043752690880113,Ks=37393792e-14,tr=11428639e-14,Ye=.00015835218,Je=119459e-10;lt=0,Z<.0052359877&&Z>.0034906585&&(lt=1),Z>=.00826&&Z<=.00924&&k>=.5&&(lt=2);var er=l*Je*f,ir=c*Je*(M+y),sr=-Je*d*(p+x-14-6*O),rr=m*Je*(w+A-6),yi=-Je*c*(S+C);(j<.052359877||j>Wt-.052359877)&&(yi=0),o!==0&&(yi/=o);var nr=rr-t*yi;K=er+i*Ye*h,rt=ir+s*Ye*(G+Y),zt=sr-Ye*r*(W+I-14-6*O);var ar=a*Ye*(U+P-6),qi=-Ye*s*(V+st);(j<.052359877||j>Wt-.052359877)&&(qi=0),bt=nr+ar,xt=yi,o!==0&&(bt-=t/o*qi,xt+=qi/o);var fs=0,Pi=(b+v*Ni)%at;if(k+=K*z,j+=rt*z,ot+=bt*z,Dt+=xt*z,nt+=zt*z,lt!==0){if(Nt=Math.pow(Z/pe,gi),lt===2){qt=t*t;var hr=k;k=Ct;var or=O;O=ft,mt=k*O,ie=-.306-(k-.64)*.44,k<=.65?(de=3.616-13.247*k+16.29*O,se=-19.302+117.39*k-228.419*O+156.591*mt,jt=-18.9068+109.7927*k-214.6334*O+146.5816*mt,Ze=-41.122+242.694*k-471.094*O+313.953*mt,tt=-146.407+841.88*k-1629.014*O+1083.435*mt,fi=-532.114+3017.977*k-5740.032*O+3708.276*mt):(de=-72.099+331.819*k-508.738*O+266.724*mt,se=-346.844+1582.851*k-2415.925*O+1246.113*mt,jt=-342.585+1554.908*k-2366.899*O+1215.972*mt,Ze=-1052.797+4758.686*k-7193.992*O+3651.957*mt,tt=-3581.69+16178.11*k-24462.77*O+12422.52*mt,k>.715?fi=-5149.66+29936.92*k-54087.36*O+31324.56*mt:fi=1464.74-4664.75*k+3763.64*O),k<.7?(Ae=-919.2277+4988.61*k-9064.77*O+5542.21*mt,Ii=-822.71072+4568.6173*k-8491.4146*O+5337.524*mt,Di=-853.666+4690.25*k-8624.77*O+5341.4*mt):(Ae=-37995.78+161616.52*k-229838.2*O+109377.94*mt,Ii=-51752.104+218913.95*k-309468.16*O+146349.42*mt,Di=-40023.88+170470.89*k-242699.48*O+115605.82*mt),me=o*o,Ot=.75*(1+2*t+qt),ut=1.5*me,ce=1.875*o*(1-2*t-3*qt),Rt=-1.875*o*(1+2*t-3*qt),ve=35*me*Ot,Gt=39.375*me*me,ue=9.84375*o*(me*(1-2*t-5*qt)+.33333333*(-2+4*t+6*qt)),te=o*(4.92187512*me*(-2-4*t+10*qt)+6.56250012*(1+2*t-3*qt)),ee=29.53125*o*(2-8*t+qt*(-12+8*t+10*qt)),Bt=29.53125*o*(-2-8*t+qt*(12+8*t-10*qt)),pi=Z*Z,xi=Nt*Nt,re=3*pi*xi,St=re*js,X=St*Ot*ie,$=St*ut*de,re*=Nt,St=re*Ks,ct=St*ce*se,J=St*Rt*jt,re*=Nt,St=2*re*Qs,L=St*ve*Ze,Q=St*Gt*tt,re*=Nt,St=re*tr,q=St*ue*fi,H=St*te*Di,St=2*re*Oi,it=St*ee*Ii,ht=St*Bt*Ae,yt=(F+T+T-(Pi+Pi))%at,u=D+zt+2*(E+xt-Ni)-B,k=hr,O=or}lt===1&&(kt=1+O*(-2.5+.8125*O),se=1+2*O,_=1+O*(-6+6.60937*O),Ot=.75*(1+t)*(1+t),wt=.9375*o*o*(1+3*t)-.75*(1+t),vt=1+t,vt*=1.875*vt*vt,_t=3*Z*Z*Nt*Nt,Ut=2*_t*Ot*kt*Xe,Lt=3*_t*vt*_*Gs*Nt,_t=_t*wt*se*Hs*Nt,yt=(F+T+e-Pi)%at,u=D+N+zt+bt+xt-(B+Ni)),dt=yt,Ht=B,pt=0,Z=B+fs}return{em:k,argpm:ot,inclm:j,mm:nt,nm:Z,nodem:Dt,irez:lt,atime:pt,d2201:X,d2211:$,d3210:ct,d3222:J,d4410:L,d4422:Q,d5220:q,d5232:H,d5421:it,d5433:ht,dedt:K,didt:rt,dmdt:zt,dndt:fs,dnodt:xt,domdt:bt,del1:_t,del2:Ut,del3:Lt,xfact:u,xlamo:yt,xli:dt,xni:Ht}}function ur(n){var t=(n-2451545)/36525,e=-62e-7*t*t*t+.093104*t*t+(876600*3600+8640184812866e-6)*t+67310.54841;return e=e*$e/240%at,e<0&&(e+=at),e}function yn(n,t,e,i,s,r,a){return n instanceof Date?ur(xs(n)):ur(n)}function gn(n){var t=n.ecco,e=n.epoch,i=n.inclo,s=n.opsmode,r=n.no,a=t*t,h=1-a,o=Math.sqrt(h),l=Math.cos(i),c=l*l,d=Math.pow(pe/r,gi),m=.75*Oe*(3*c-1)/(o*h),f=m/(d*d),p=d*(1-f*f-f*(1/3+134*f*f/81));f=m/(p*p),r/=1+f;var x=Math.pow(pe/r,gi),M=Math.sin(i),y=x*h,S=1-5*c,C=-S-c-c,w=1/x,A=y*y,z=x*(1-t),v="n",b;if(s==="a"){var F=e-7305,D=Math.floor(F+1e-8),B=F-D,T=.017202791694070362,E=1.7321343856509375,N=5075514194322695e-30,W=T+at;b=(E+T*D+W*B+F*F*N)%at,b<0&&(b+=at)}else b=yn(e+24332815e-1);return{no:r,method:v,ainv:w,ao:x,con41:C,con42:S,cosio:l,cosio2:c,eccsq:a,omeosq:h,posq:A,rp:z,rteosq:o,sinio:M,gsto:b}}function Mn(n){var t=n.irez,e=n.d2201,i=n.d2211,s=n.d3210,r=n.d3222,a=n.d4410,h=n.d4422,o=n.d5220,l=n.d5232,c=n.d5421,d=n.d5433,m=n.dedt,f=n.del1,p=n.del2,x=n.del3,M=n.didt,y=n.dmdt,S=n.dnodt,C=n.domdt,w=n.argpo,A=n.argpdot,z=n.t,v=n.tc,b=n.gsto,F=n.xfact,D=n.xlamo,B=n.no,T=n.atime,E=n.em,N=n.argpm,W=n.inclm,I=n.xli,G=n.mm,Y=n.xni,V=n.nodem,st=n.nm,U=.13130908,P=2.8843198,Ct=.37448087,ft=5.7686396,O=.95240898,k=1.8014998,ot=1.050833,j=4.4108898,nt=.0043752690880113,Z=720,Dt=-720,lt=259200,pt,X,$,ct,J,L,Q,q,H=0,it=0,ht=(b+v*nt)%at;if(E+=m*z,W+=M*z,N+=C*z,V+=S*z,G+=y*z,t!==0){(T===0||z*T<=0||Math.abs(z)<Math.abs(T))&&(T=0,Y=B,I=D),z>0?pt=Z:pt=Dt;for(var K=381;K===381;)t!==2?(Q=f*Math.sin(I-U)+p*Math.sin(2*(I-P))+x*Math.sin(3*(I-Ct)),J=Y+F,L=f*Math.cos(I-U)+2*p*Math.cos(2*(I-P))+3*x*Math.cos(3*(I-Ct)),L*=J):(q=w+A*T,$=q+q,X=I+I,Q=e*Math.sin($+I-ft)+i*Math.sin(I-ft)+s*Math.sin(q+I-O)+r*Math.sin(-q+I-O)+a*Math.sin($+X-k)+h*Math.sin(X-k)+o*Math.sin(q+I-ot)+l*Math.sin(-q+I-ot)+c*Math.sin(q+X-j)+d*Math.sin(-q+X-j),J=Y+F,L=e*Math.cos($+I-ft)+i*Math.cos(I-ft)+s*Math.cos(q+I-O)+r*Math.cos(-q+I-O)+o*Math.cos(q+I-ot)+l*Math.cos(-q+I-ot)+2*(a*Math.cos($+X-k)+h*Math.cos(X-k)+c*Math.cos(q+X-j)+d*Math.cos(-q+X-j)),L*=J),Math.abs(z-T)>=Z?K=381:(it=z-T,K=0),K===381&&(I+=J*pt+Q*lt,Y+=Q*pt+L*lt,T+=pt);st=Y+Q*it+L*it*it*.5,ct=I+J*it+Q*it*it*.5,t!==1?(G=ct-2*V+2*ht,H=st-B):(G=ct-V-N+ht,H=st-B),st=B+H}return{atime:T,em:E,argpm:N,inclm:W,xli:I,mm:G,xni:Y,nodem:V,dndt:H,nm:st}}var _e;(function(n){n[n.None=0]="None",n[n.MeanEccentricityOutOfRange=1]="MeanEccentricityOutOfRange",n[n.MeanMotionBelowZero=2]="MeanMotionBelowZero",n[n.PerturbedEccentricityOutOfRange=3]="PerturbedEccentricityOutOfRange",n[n.SemiLatusRectumBelowZero=4]="SemiLatusRectumBelowZero",n[n.Decayed=6]="Decayed"})(_e||(_e={}));function ys(n,t){var e,i,s,r,a,h,o,l,c,d,m,f,p,x,M,y,S,C,w,A,z,v,b,F,D,B,T,E=15e-13;n.t=t,n.error=_e.None;var N=n.mo+n.mdot*n.t,W=n.argpo+n.argpdot*n.t,I=n.nodeo+n.nodedot*n.t;c=W,z=N;var G=n.t*n.t;if(b=I+n.nodecf*G,S=1-n.cc1*n.t,C=n.bstar*n.cc4*n.t,w=n.t2cof*G,n.isimp!==1){o=n.omgcof*n.t;var Y=1+n.eta*Math.cos(N);h=n.xmcof*(Y*Y*Y-n.delmo),y=o+h,z=N+y,c=W-y,f=G*n.t,p=f*n.t,S=S-n.d2*G-n.d3*f-n.d4*p,C+=n.bstar*n.cc5*(Math.sin(z)-n.sinmao),w=w+n.t3cof*f+p*(n.t4cof+n.t*n.t5cof)}v=n.no;var V=n.ecco;if(A=n.inclo,n.method==="d"){x=n.t;var st={irez:n.irez,d2201:n.d2201,d2211:n.d2211,d3210:n.d3210,d3222:n.d3222,d4410:n.d4410,d4422:n.d4422,d5220:n.d5220,d5232:n.d5232,d5421:n.d5421,d5433:n.d5433,dedt:n.dedt,del1:n.del1,del2:n.del2,del3:n.del3,didt:n.didt,dmdt:n.dmdt,dnodt:n.dnodt,domdt:n.domdt,argpo:n.argpo,argpdot:n.argpdot,t:n.t,tc:x,gsto:n.gsto,xfact:n.xfact,xlamo:n.xlamo,no:n.no,atime:n.atime,em:V,argpm:c,inclm:A,xli:n.xli,mm:z,xni:n.xni,nodem:b,nm:v},U=Mn(st);V=U.em,c=U.argpm,A=U.inclm,z=U.mm,b=U.nodem,v=U.nm}if(v<=0)return n.error=_e.MeanMotionBelowZero,null;var P=Math.pow(pe/v,gi)*S*S;if(v=pe/Math.pow(P,1.5),V-=C,V>=1||V<-.001)return n.error=_e.MeanEccentricityOutOfRange,null;V<1e-6&&(V=1e-6),z+=n.no*w,D=z+c+b,b%=at,c%=at,D%=at,z=(D-c-b)%at;var Ct={am:P,em:V,im:A,Om:b,om:c,mm:z,nm:v},ft=Math.sin(A),O=Math.cos(A),k=V;if(F=A,d=c,T=b,B=z,r=ft,s=O,n.method==="d"){var ot={inclo:n.inclo,init:"n",ep:k,inclp:F,nodep:T,argpp:d,mp:B,opsmode:n.operationmode},j=cr(n,ot);if(k=j.ep,T=j.nodep,d=j.argpp,B=j.mp,F=j.inclp,F<0&&(F=-F,T+=Wt,d-=Wt),k<0||k>1)return n.error=_e.PerturbedEccentricityOutOfRange,null}n.method==="d"&&(r=Math.sin(F),s=Math.cos(F),n.aycof=-.5*Ne*r,Math.abs(s+1)>15e-13?n.xlcof=-.25*Ne*r*(3+5*s)/(1+s):n.xlcof=-.25*Ne*r*(3+5*s)/E);var nt=k*Math.cos(d);y=1/(P*(1-k*k));var Z=k*Math.sin(d)+y*n.aycof,Dt=B+d+T+y*n.xlcof*nt,lt=(Dt-T)%at;l=lt,M=9999.9;for(var pt=1;Math.abs(M)>=1e-12&&pt<=10;)i=Math.sin(l),e=Math.cos(l),M=1-e*nt-i*Z,M=(lt-Z*e+nt*i-l)/M,Math.abs(M)>=.95&&(M>0?M=.95:M=-.95),l+=M,pt+=1;var X=nt*e+Z*i,$=nt*i-Z*e,ct=nt*nt+Z*Z,J=P*(1-ct);if(J<0)return n.error=_e.SemiLatusRectumBelowZero,null;var L=P*(1-X),Q=Math.sqrt(P)*$/L,q=Math.sqrt(J)/L,H=Math.sqrt(1-ct);y=$/(1+H);var it=P/L*(i-Z-nt*y),ht=P/L*(e-nt+Z*y);m=Math.atan2(it,ht);var K=(ht+ht)*it,rt=1-2*it*it;y=1/J;var zt=.5*Oe*y,xt=zt*y;n.method==="d"&&(a=s*s,n.con41=3*a-1,n.x1mth2=1-a,n.x7thm1=7*a-1);var bt=L*(1-1.5*xt*H*n.con41)+.5*zt*n.x1mth2*rt;if(bt<1)return n.error=_e.Decayed,null;m-=.25*xt*n.x7thm1*K;var _t=T+1.5*xt*s*K,Ut=F+1.5*xt*s*r*rt,Lt=Q-v*zt*n.x1mth2*K/pe,u=q+v*zt*(n.x1mth2*rt+1.5*n.con41)/pe,yt=Math.sin(m),dt=Math.cos(m),Ht=Math.sin(_t),Ot=Math.cos(_t),ut=Math.sin(Ut),wt=Math.cos(Ut),ce=-Ht*wt,Rt=Ot*wt,vt=ce*yt+Ot*dt,ve=Rt*yt+Ht*dt,Gt=ut*yt,ue=ce*dt-Ot*yt,te=Rt*dt-Ht*yt,ee=ut*dt,Bt={x:bt*vt*Vt,y:bt*ve*Vt,z:bt*Gt*Vt},kt={x:(Lt*vt+u*ue)*ps,y:(Lt*ve+u*te)*ps,z:(Lt*Gt+u*ee)*ps};return{position:Bt,velocity:kt,meanElements:Ct}}function zn(n,t){var e=t.opsmode,i=t.epoch,s=t.xbstar,r=t.xecco,a=t.xargpo,h=t.xinclo,o=t.xmo,l=t.xno,c=t.xnodeo,d,m,f,p,x,M,y,S,C,w,A,z,v,b,F,D,B,T,E,N,W,I,G,Y,V,st,U,P,Ct,ft,O,k,ot,j,nt,Z,Dt,lt,pt,X,$,ct,J,L,Q,q,H,it,ht,K,rt,zt,xt,bt,_t,Ut,Lt=15e-13,u=n;u.isimp=0,u.method="n",u.aycof=0,u.con41=0,u.cc1=0,u.cc4=0,u.cc5=0,u.d2=0,u.d3=0,u.d4=0,u.delmo=0,u.eta=0,u.argpdot=0,u.omgcof=0,u.sinmao=0,u.t=0,u.t2cof=0,u.t3cof=0,u.t4cof=0,u.t5cof=0,u.x1mth2=0,u.x7thm1=0,u.mdot=0,u.nodedot=0,u.xlcof=0,u.xmcof=0,u.nodecf=0,u.irez=0,u.d2201=0,u.d2211=0,u.d3210=0,u.d3222=0,u.d4410=0,u.d4422=0,u.d5220=0,u.d5232=0,u.d5421=0,u.d5433=0,u.dedt=0,u.del1=0,u.del2=0,u.del3=0,u.didt=0,u.dmdt=0,u.dnodt=0,u.domdt=0,u.e3=0,u.ee2=0,u.peo=0,u.pgho=0,u.pho=0,u.pinco=0,u.plo=0,u.se2=0,u.se3=0,u.sgh2=0,u.sgh3=0,u.sgh4=0,u.sh2=0,u.sh3=0,u.si2=0,u.si3=0,u.sl2=0,u.sl3=0,u.sl4=0,u.gsto=0,u.xfact=0,u.xgh2=0,u.xgh3=0,u.xgh4=0,u.xh2=0,u.xh3=0,u.xi2=0,u.xi3=0,u.xl2=0,u.xl3=0,u.xl4=0,u.xlamo=0,u.zmol=0,u.zmos=0,u.atime=0,u.xli=0,u.xni=0,u.bstar=s,u.ecco=r,u.argpo=a,u.inclo=h,u.mo=o,u.no=l,u.nodeo=c,u.operationmode=e;var yt=78/Vt+1,dt=42/Vt,Ht=dt*dt*dt*dt;u.init="y",u.t=0;var Ot={ecco:u.ecco,epoch:i,inclo:u.inclo,no:u.no,method:u.method,opsmode:u.operationmode},ut=gn(Ot),wt=ut.ao,ce=ut.con42,Rt=ut.cosio,vt=ut.cosio2,ve=ut.eccsq,Gt=ut.omeosq,ue=ut.posq,te=ut.rp,ee=ut.rteosq,Bt=ut.sinio;if(u.no=ut.no,u.con41=ut.con41,u.gsto=ut.gsto,u.a=Math.pow(u.no*cn,-2/3),u.alta=u.a*(1+u.ecco)-1,u.altp=u.a*(1-u.ecco)-1,u.error=0,Gt>=0||u.no>=0){if(u.isimp=0,te<220/Vt+1&&(u.isimp=1),U=yt,W=Ht,T=(te-1)*Vt,T<156){U=T-78,T<98&&(U=20);var kt=(120-U)/Vt;W=kt*kt*kt*kt,U=U/Vt+1}E=1/ue,q=1/(wt-U),u.eta=wt*u.ecco*q,z=u.eta*u.eta,A=u.ecco*u.eta,N=Math.abs(1-z),M=W*Math.pow(q,4),y=M/Math.pow(N,3.5),p=y*u.no*(wt*(1+1.5*z+A*(4+z))+.375*Oe*q/N*u.con41*(8+3*z*(8+z))),u.cc1=u.bstar*p,x=0,u.ecco>1e-4&&(x=-2*M*q*Ne*u.no*Bt/u.ecco),u.x1mth2=1-vt,u.cc4=2*u.no*y*wt*Gt*(u.eta*(2+.5*z)+u.ecco*(.5+2*z)-Oe*q/(wt*N)*(-3*u.con41*(1-2*A+z*(1.5-.5*A))+.75*u.x1mth2*(2*z-A*(1+z))*Math.cos(2*u.argpo))),u.cc5=2*y*wt*Gt*(1+2.75*(z+A)+A*z),S=vt*vt,J=1.5*Oe*E*u.no,L=.5*J*Oe*E,Q=-.46875*dn*E*E*u.no,u.mdot=u.no+.5*J*ee*u.con41+.0625*L*ee*(13-78*vt+137*S),u.argpdot=-.5*J*ce+.0625*L*(7-114*vt+395*S)+Q*(3-36*vt+49*S),it=-J*Rt,u.nodedot=it+(.5*L*(4-19*vt)+2*Q*(3-7*vt))*Rt,H=u.argpdot+u.nodedot,u.omgcof=u.bstar*x*Math.cos(u.argpo),u.xmcof=0,u.ecco>1e-4&&(u.xmcof=-gi*M*u.bstar/A),u.nodecf=3.5*Gt*it*u.cc1,u.t2cof=1.5*u.cc1,Math.abs(Rt+1)>15e-13?u.xlcof=-.25*Ne*Bt*(3+5*Rt)/(1+Rt):u.xlcof=-.25*Ne*Bt*(3+5*Rt)/Lt,u.aycof=-.5*Ne*Bt;var ie=1+u.eta*Math.cos(u.mo);if(u.delmo=ie*ie*ie,u.sinmao=Math.sin(u.mo),u.x7thm1=7*vt-1,2*Wt/u.no>=225){u.method="d",u.isimp=1,$=0,F=u.inclo;var de={epoch:i,ep:u.ecco,argpp:u.argpo,tc:$,inclp:u.inclo,nodep:u.nodeo,np:u.no,e3:u.e3,ee2:u.ee2,peo:u.peo,pgho:u.pgho,pho:u.pho,pinco:u.pinco,plo:u.plo,se2:u.se2,se3:u.se3,sgh2:u.sgh2,sgh3:u.sgh3,sgh4:u.sgh4,sh2:u.sh2,sh3:u.sh3,si2:u.si2,si3:u.si3,sl2:u.sl2,sl3:u.sl3,sl4:u.sl4,xgh2:u.xgh2,xgh3:u.xgh3,xgh4:u.xgh4,xh2:u.xh2,xh3:u.xh3,xi2:u.xi2,xi3:u.xi3,xl2:u.xl2,xl3:u.xl3,xl4:u.xl4,zmol:u.zmol,zmos:u.zmos},_=pn(de);u.e3=_.e3,u.ee2=_.ee2,u.peo=_.peo,u.pgho=_.pgho,u.pho=_.pho,u.pinco=_.pinco,u.plo=_.plo,u.se2=_.se2,u.se3=_.se3,u.sgh2=_.sgh2,u.sgh3=_.sgh3,u.sgh4=_.sgh4,u.sh2=_.sh2,u.sh3=_.sh3,u.si2=_.si2,u.si3=_.si3,u.sl2=_.sl2,u.sl3=_.sl3,u.sl4=_.sl4,m=_.sinim,d=_.cosim,C=_.em,w=_.emsq,I=_.s1,G=_.s2,Y=_.s3,V=_.s4,st=_.s5,P=_.ss1,Ct=_.ss2,ft=_.ss3,O=_.ss4,k=_.ss5,ot=_.sz1,j=_.sz3,nt=_.sz11,Z=_.sz13,Dt=_.sz21,lt=_.sz23,pt=_.sz31,X=_.sz33,u.xgh2=_.xgh2,u.xgh3=_.xgh3,u.xgh4=_.xgh4,u.xh2=_.xh2,u.xh3=_.xh3,u.xi2=_.xi2,u.xi3=_.xi3,u.xl2=_.xl2,u.xl3=_.xl3,u.xl4=_.xl4,u.zmol=_.zmol,u.zmos=_.zmos,B=_.nm,ht=_.z1,K=_.z3,rt=_.z11,zt=_.z13,xt=_.z21,bt=_.z23,_t=_.z31,Ut=_.z33;var se={inclo:F,init:u.init,ep:u.ecco,inclp:u.inclo,nodep:u.nodeo,argpp:u.argpo,mp:u.mo,opsmode:u.operationmode},jt=cr(u,se);u.ecco=jt.ep,u.inclo=jt.inclp,u.nodeo=jt.nodep,u.argpo=jt.argpp,u.mo=jt.mp,v=0,b=0,D=0;var Ze={cosim:d,emsq:w,argpo:u.argpo,s1:I,s2:G,s3:Y,s4:V,s5:st,sinim:m,ss1:P,ss2:Ct,ss3:ft,ss4:O,ss5:k,sz1:ot,sz3:j,sz11:nt,sz13:Z,sz21:Dt,sz23:lt,sz31:pt,sz33:X,t:u.t,tc:$,gsto:u.gsto,mo:u.mo,mdot:u.mdot,no:u.no,nodeo:u.nodeo,nodedot:u.nodedot,xpidot:H,z1:ht,z3:K,z11:rt,z13:zt,z21:xt,z23:bt,z31:_t,z33:Ut,ecco:u.ecco,eccsq:ve,em:C,argpm:v,inclm:F,mm:D,nm:B,nodem:b,irez:u.irez,atime:u.atime,d2201:u.d2201,d2211:u.d2211,d3210:u.d3210,d3222:u.d3222,d4410:u.d4410,d4422:u.d4422,d5220:u.d5220,d5232:u.d5232,d5421:u.d5421,d5433:u.d5433,dedt:u.dedt,didt:u.didt,dmdt:u.dmdt,dnodt:u.dnodt,domdt:u.domdt,del1:u.del1,del2:u.del2,del3:u.del3,xfact:u.xfact,xlamo:u.xlamo,xli:u.xli,xni:u.xni},tt=xn(Ze);u.irez=tt.irez,u.atime=tt.atime,u.d2201=tt.d2201,u.d2211=tt.d2211,u.d3210=tt.d3210,u.d3222=tt.d3222,u.d4410=tt.d4410,u.d4422=tt.d4422,u.d5220=tt.d5220,u.d5232=tt.d5232,u.d5421=tt.d5421,u.d5433=tt.d5433,u.dedt=tt.dedt,u.didt=tt.didt,u.dmdt=tt.dmdt,u.dnodt=tt.dnodt,u.domdt=tt.domdt,u.del1=tt.del1,u.del2=tt.del2,u.del3=tt.del3,u.xfact=tt.xfact,u.xlamo=tt.xlamo,u.xli=tt.xli,u.xni=tt.xni}u.isimp!==1&&(f=u.cc1*u.cc1,u.d2=4*wt*q*f,ct=u.d2*q*u.cc1/3,u.d3=(17*wt+U)*ct,u.d4=.5*ct*wt*q*(221*wt+31*U)*u.cc1,u.t3cof=u.d2+2*f,u.t4cof=.25*(3*u.d3+u.cc1*(12*u.d2+10*f)),u.t5cof=.2*(3*u.d4+12*u.cc1*u.d3+6*u.d2*u.d2+15*f*(2*u.d2+f)))}ys(u,0),u.init="n"}function bn(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"i",e=0,i=n.NORAD_CAT_ID.toString(),s=new Date(n.EPOCH.endsWith("Z")?n.EPOCH:n.EPOCH+"Z"),r=s.getUTCFullYear(),a=Number(r.toString().slice(-2)),h=(s.valueOf()-new Date(Date.UTC(r,0,1,0,0,0)).valueOf())/(86400*1e3)+1,o=Number(n.MEAN_MOTION_DOT),l=Number(n.MEAN_MOTION_DDOT),c=Number(n.BSTAR),d=Number(n.INCLINATION)*$e,m=Number(n.RA_OF_ASC_NODE)*$e,f=Number(n.ECCENTRICITY),p=Number(n.ARG_OF_PERICENTER)*$e,x=Number(n.MEAN_ANOMALY)*$e,M=Number(n.MEAN_MOTION)/mn,y=fn(r,h),S=y.mon,C=y.day,w=y.hr,A=y.minute,z=y.sec,v=xs(r,S,C,w,A,z),b={error:e,satnum:i,epochyr:a,epochdays:h,ndot:o,nddot:l,bstar:c,inclo:d,nodeo:m,ecco:f,argpo:p,mo:x,no:M,jdsatepoch:v};return zn(b,{opsmode:t,satn:b.satnum,epoch:b.jdsatepoch-24332815e-1,xbstar:b.bstar,xecco:b.ecco,xargpo:b.argpo,xinclo:b.inclo,xmo:b.mo,xno:b.no,xnodeo:b.nodeo}),b}function wn(n){for(var t=arguments.length,e=new Array(t>1?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];var s=xs.apply(void 0,e),r=(s-n.jdsatepoch)*on;return ys(n,r)}function He(n){return n*hn}function dr(n){return n*$e}function Ui(n){var t=n.longitude,e=n.latitude,i=n.height,s=6378.137,r=6356.7523142,a=(s-r)/s,h=2*a-a*a,o=s/Math.sqrt(1-h*(Math.sin(e)*Math.sin(e))),l=(o+i)*Math.cos(e)*Math.cos(t),c=(o+i)*Math.cos(e)*Math.sin(t),d=(o*(1-h)+i)*Math.sin(e);return{x:l,y:c,z:d}}function vn(n,t){for(var e=6378.137,i=6356.7523142,s=Math.sqrt(n.x*n.x+n.y*n.y),r=(e-i)/e,a=2*r-r*r,h=Math.atan2(n.y,n.x)-t;h<-Wt;)h+=at;for(;h>Wt;)h-=at;for(var o=20,l=0,c=Math.atan2(n.z,Math.sqrt(n.x*n.x+n.y*n.y)),d;l++<o;)d=1/Math.sqrt(1-a*(Math.sin(c)*Math.sin(c))),c=Math.atan2(n.z+e*d*a*Math.sin(c),s);var m=s/Math.cos(c)-e*d;return{longitude:h,latitude:c,height:m}}function An(n,t){var e=n.x*Math.cos(t)-n.y*Math.sin(t),i=n.x*Math.sin(t)+n.y*Math.cos(t),s=n.z;return{x:e,y:i,z:s}}function mr(n,t){var e=n.x*Math.cos(t)+n.y*Math.sin(t),i=n.x*-Math.sin(t)+n.y*Math.cos(t),s=n.z;return{x:e,y:i,z:s}}function _n(n,t){var e=n.longitude,i=n.latitude,s=Ui(n),r=t.x-s.x,a=t.y-s.y,h=t.z-s.z,o=Math.sin(i)*Math.cos(e)*r+Math.sin(i)*Math.sin(e)*a-Math.cos(i)*h,l=-Math.sin(e)*r+Math.cos(e)*a,c=Math.cos(i)*Math.cos(e)*r+Math.cos(i)*Math.sin(e)*a+Math.sin(i)*h;return{topS:o,topE:l,topZ:c}}function Sn(n){var t=n.topS,e=n.topE,i=n.topZ,s=Math.sqrt(t*t+e*e+i*i),r=Math.asin(i/s),a=Math.atan2(-e,t)+Wt;return{azimuth:a,elevation:r,rangeSat:s}}function fr(n,t){var e=_n(n,t);return Sn(e)}const pr="181",gs=0,Fn=1,xr=1,yr=100,gr=204,Mr=205,zr=3,Cn=0,br=300,wr=1e3,Li=1001,vr=1002,Tn=1006,Bn=1008,kn=1009,En=1015,In=1023,Ar="",ne="srgb",_r="srgb-linear",Sr="linear",Ms="srgb",Ge=7680,Fr=519,zs=35044,Ri=2e3,Cr=2001;function Dn(n){for(let t=n.length-1;t>=0;--t)if(n[t]>=65535)return!0;return!1}function Tr(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}const Br={};function kr(...n){const t="THREE."+n.shift();console.log(t,...n)}function Tt(...n){const t="THREE."+n.shift();console.warn(t,...n)}function Se(...n){const t="THREE."+n.shift();console.error(t,...n)}function Er(...n){const t=n.join(" ");t in Br||(Br[t]=!0,Tt(...n))}class Wi{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[t]===void 0&&(i[t]=[]),i[t].indexOf(e)===-1&&i[t].push(e)}hasEventListener(t,e){const i=this._listeners;return i===void 0?!1:i[t]!==void 0&&i[t].indexOf(e)!==-1}removeEventListener(t,e){const i=this._listeners;if(i===void 0)return;const s=i[t];if(s!==void 0){const r=s.indexOf(e);r!==-1&&s.splice(r,1)}}dispatchEvent(t){const e=this._listeners;if(e===void 0)return;const i=e[t.type];if(i!==void 0){t.target=this;const s=i.slice(0);for(let r=0,a=s.length;r<a;r++)s[r].call(this,t);t.target=null}}}const Et=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function Fe(){const n=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Et[n&255]+Et[n>>8&255]+Et[n>>16&255]+Et[n>>24&255]+"-"+Et[t&255]+Et[t>>8&255]+"-"+Et[t>>16&15|64]+Et[t>>24&255]+"-"+Et[e&63|128]+Et[e>>8&255]+"-"+Et[e>>16&255]+Et[e>>24&255]+Et[i&255]+Et[i>>8&255]+Et[i>>16&255]+Et[i>>24&255]).toLowerCase()}function R(n,t,e){return Math.max(t,Math.min(e,n))}function On(n,t){return(n%t+t)%t}function bs(n,t,e){return(1-e)*n+e*t}function fe(n,t){switch(t.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function et(n,t){switch(t.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}class At{constructor(t=0,e=0){At.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6],this.y=s[1]*e+s[4]*i+s[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=R(this.x,t.x,e.x),this.y=R(this.y,t.y,e.y),this}clampScalar(t,e){return this.x=R(this.x,t,e),this.y=R(this.y,t,e),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(R(i,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(R(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),s=Math.sin(e),r=this.x-t.x,a=this.y-t.y;return this.x=r*i-a*s+t.x,this.y=r*s+a*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Mi{constructor(t=0,e=0,i=0,s=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=s}static slerpFlat(t,e,i,s,r,a,h){let o=i[s+0],l=i[s+1],c=i[s+2],d=i[s+3],m=r[a+0],f=r[a+1],p=r[a+2],x=r[a+3];if(h<=0){t[e+0]=o,t[e+1]=l,t[e+2]=c,t[e+3]=d;return}if(h>=1){t[e+0]=m,t[e+1]=f,t[e+2]=p,t[e+3]=x;return}if(d!==x||o!==m||l!==f||c!==p){let M=o*m+l*f+c*p+d*x;M<0&&(m=-m,f=-f,p=-p,x=-x,M=-M);let y=1-h;if(M<.9995){const S=Math.acos(M),C=Math.sin(S);y=Math.sin(y*S)/C,h=Math.sin(h*S)/C,o=o*y+m*h,l=l*y+f*h,c=c*y+p*h,d=d*y+x*h}else{o=o*y+m*h,l=l*y+f*h,c=c*y+p*h,d=d*y+x*h;const S=1/Math.sqrt(o*o+l*l+c*c+d*d);o*=S,l*=S,c*=S,d*=S}}t[e]=o,t[e+1]=l,t[e+2]=c,t[e+3]=d}static multiplyQuaternionsFlat(t,e,i,s,r,a){const h=i[s],o=i[s+1],l=i[s+2],c=i[s+3],d=r[a],m=r[a+1],f=r[a+2],p=r[a+3];return t[e]=h*p+c*d+o*f-l*m,t[e+1]=o*p+c*m+l*d-h*f,t[e+2]=l*p+c*f+h*m-o*d,t[e+3]=c*p-h*d-o*m-l*f,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,s){return this._x=t,this._y=e,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const i=t._x,s=t._y,r=t._z,a=t._order,h=Math.cos,o=Math.sin,l=h(i/2),c=h(s/2),d=h(r/2),m=o(i/2),f=o(s/2),p=o(r/2);switch(a){case"XYZ":this._x=m*c*d+l*f*p,this._y=l*f*d-m*c*p,this._z=l*c*p+m*f*d,this._w=l*c*d-m*f*p;break;case"YXZ":this._x=m*c*d+l*f*p,this._y=l*f*d-m*c*p,this._z=l*c*p-m*f*d,this._w=l*c*d+m*f*p;break;case"ZXY":this._x=m*c*d-l*f*p,this._y=l*f*d+m*c*p,this._z=l*c*p+m*f*d,this._w=l*c*d-m*f*p;break;case"ZYX":this._x=m*c*d-l*f*p,this._y=l*f*d+m*c*p,this._z=l*c*p-m*f*d,this._w=l*c*d+m*f*p;break;case"YZX":this._x=m*c*d+l*f*p,this._y=l*f*d+m*c*p,this._z=l*c*p-m*f*d,this._w=l*c*d-m*f*p;break;case"XZY":this._x=m*c*d-l*f*p,this._y=l*f*d-m*c*p,this._z=l*c*p+m*f*d,this._w=l*c*d+m*f*p;break;default:Tt("Quaternion: .setFromEuler() encountered an unknown order: "+a)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,s=Math.sin(i);return this._x=t.x*s,this._y=t.y*s,this._z=t.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],s=e[4],r=e[8],a=e[1],h=e[5],o=e[9],l=e[2],c=e[6],d=e[10],m=i+h+d;if(m>0){const f=.5/Math.sqrt(m+1);this._w=.25/f,this._x=(c-o)*f,this._y=(r-l)*f,this._z=(a-s)*f}else if(i>h&&i>d){const f=2*Math.sqrt(1+i-h-d);this._w=(c-o)/f,this._x=.25*f,this._y=(s+a)/f,this._z=(r+l)/f}else if(h>d){const f=2*Math.sqrt(1+h-i-d);this._w=(r-l)/f,this._x=(s+a)/f,this._y=.25*f,this._z=(o+c)/f}else{const f=2*Math.sqrt(1+d-i-h);this._w=(a-s)/f,this._x=(r+l)/f,this._y=(o+c)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<1e-8?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(R(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(i===0)return this;const s=Math.min(1,e/i);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,s=t._y,r=t._z,a=t._w,h=e._x,o=e._y,l=e._z,c=e._w;return this._x=i*c+a*h+s*l-r*o,this._y=s*c+a*o+r*h-i*l,this._z=r*c+a*l+i*o-s*h,this._w=a*c-i*h-s*o-r*l,this._onChangeCallback(),this}slerp(t,e){if(e<=0)return this;if(e>=1)return this.copy(t);let i=t._x,s=t._y,r=t._z,a=t._w,h=this.dot(t);h<0&&(i=-i,s=-s,r=-r,a=-a,h=-h);let o=1-e;if(h<.9995){const l=Math.acos(h),c=Math.sin(l);o=Math.sin(o*l)/c,e=Math.sin(e*l)/c,this._x=this._x*o+i*e,this._y=this._y*o+s*e,this._z=this._z*o+r*e,this._w=this._w*o+a*e,this._onChangeCallback()}else this._x=this._x*o+i*e,this._y=this._y*o+s*e,this._z=this._z*o+r*e,this._w=this._w*o+a*e,this.normalize();return this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),i=Math.random(),s=Math.sqrt(1-i),r=Math.sqrt(i);return this.set(s*Math.sin(t),s*Math.cos(t),r*Math.sin(e),r*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class g{constructor(t=0,e=0,i=0){g.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return i===void 0&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(Ir.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Ir.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,s=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*s,this.y=r[1]*e+r[4]*i+r[7]*s,this.z=r[2]*e+r[5]*i+r[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,s=this.z,r=t.elements,a=1/(r[3]*e+r[7]*i+r[11]*s+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*s+r[12])*a,this.y=(r[1]*e+r[5]*i+r[9]*s+r[13])*a,this.z=(r[2]*e+r[6]*i+r[10]*s+r[14])*a,this}applyQuaternion(t){const e=this.x,i=this.y,s=this.z,r=t.x,a=t.y,h=t.z,o=t.w,l=2*(a*s-h*i),c=2*(h*e-r*s),d=2*(r*i-a*e);return this.x=e+o*l+a*d-h*c,this.y=i+o*c+h*l-r*d,this.z=s+o*d+r*c-a*l,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,s=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*s,this.y=r[1]*e+r[5]*i+r[9]*s,this.z=r[2]*e+r[6]*i+r[10]*s,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=R(this.x,t.x,e.x),this.y=R(this.y,t.y,e.y),this.z=R(this.z,t.z,e.z),this}clampScalar(t,e){return this.x=R(this.x,t,e),this.y=R(this.y,t,e),this.z=R(this.z,t,e),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(R(i,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,s=t.y,r=t.z,a=e.x,h=e.y,o=e.z;return this.x=s*o-r*h,this.y=r*a-i*o,this.z=i*h-s*a,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return ws.copy(this).projectOnVector(t),this.sub(ws)}reflect(t){return this.sub(ws.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(R(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,s=this.z-t.z;return e*e+i*i+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const s=Math.sin(e)*t;return this.x=s*Math.sin(i),this.y=Math.cos(e)*t,this.z=s*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=s,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=Math.random()*2-1,i=Math.sqrt(1-e*e);return this.x=i*Math.cos(t),this.y=e,this.z=i*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const ws=new g,Ir=new Mi;class Ce{constructor(t,e,i,s,r,a,h,o,l){Ce.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,i,s,r,a,h,o,l)}set(t,e,i,s,r,a,h,o,l){const c=this.elements;return c[0]=t,c[1]=s,c[2]=h,c[3]=e,c[4]=r,c[5]=o,c[6]=i,c[7]=a,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,r=this.elements,a=i[0],h=i[3],o=i[6],l=i[1],c=i[4],d=i[7],m=i[2],f=i[5],p=i[8],x=s[0],M=s[3],y=s[6],S=s[1],C=s[4],w=s[7],A=s[2],z=s[5],v=s[8];return r[0]=a*x+h*S+o*A,r[3]=a*M+h*C+o*z,r[6]=a*y+h*w+o*v,r[1]=l*x+c*S+d*A,r[4]=l*M+c*C+d*z,r[7]=l*y+c*w+d*v,r[2]=m*x+f*S+p*A,r[5]=m*M+f*C+p*z,r[8]=m*y+f*w+p*v,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],s=t[2],r=t[3],a=t[4],h=t[5],o=t[6],l=t[7],c=t[8];return e*a*c-e*h*l-i*r*c+i*h*o+s*r*l-s*a*o}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],r=t[3],a=t[4],h=t[5],o=t[6],l=t[7],c=t[8],d=c*a-h*l,m=h*o-c*r,f=l*r-a*o,p=e*d+i*m+s*f;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const x=1/p;return t[0]=d*x,t[1]=(s*l-c*i)*x,t[2]=(h*i-s*a)*x,t[3]=m*x,t[4]=(c*e-s*o)*x,t[5]=(s*r-h*e)*x,t[6]=f*x,t[7]=(i*o-l*e)*x,t[8]=(a*e-i*r)*x,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,s,r,a,h){const o=Math.cos(r),l=Math.sin(r);return this.set(i*o,i*l,-i*(o*a+l*h)+a+t,-s*l,s*o,-s*(-l*a+o*h)+h+e,0,0,1),this}scale(t,e){return this.premultiply(vs.makeScale(t,e)),this}rotate(t){return this.premultiply(vs.makeRotation(-t)),this}translate(t,e){return this.premultiply(vs.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,i,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,i=t.elements;for(let s=0;s<9;s++)if(e[s]!==i[s])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const vs=new Ce,Dr=new Ce().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Or=new Ce().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function Nn(){const n={enabled:!0,workingColorSpace:_r,spaces:{},convert:function(s,r,a){return this.enabled===!1||r===a||!r||!a||(this.spaces[r].transfer===Ms&&(s.r=xe(s.r),s.g=xe(s.g),s.b=xe(s.b)),this.spaces[r].primaries!==this.spaces[a].primaries&&(s.applyMatrix3(this.spaces[r].toXYZ),s.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===Ms&&(s.r=je(s.r),s.g=je(s.g),s.b=je(s.b))),s},workingToColorSpace:function(s,r){return this.convert(s,this.workingColorSpace,r)},colorSpaceToWorking:function(s,r){return this.convert(s,r,this.workingColorSpace)},getPrimaries:function(s){return this.spaces[s].primaries},getTransfer:function(s){return s===Ar?Sr:this.spaces[s].transfer},getToneMappingMode:function(s){return this.spaces[s].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(s,r=this.workingColorSpace){return s.fromArray(this.spaces[r].luminanceCoefficients)},define:function(s){Object.assign(this.spaces,s)},_getMatrix:function(s,r,a){return s.copy(this.spaces[r].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(s){return this.spaces[s].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(s=this.workingColorSpace){return this.spaces[s].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(s,r){return Er("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),n.workingToColorSpace(s,r)},toWorkingColorSpace:function(s,r){return Er("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),n.colorSpaceToWorking(s,r)}},t=[.64,.33,.3,.6,.15,.06],e=[.2126,.7152,.0722],i=[.3127,.329];return n.define({[_r]:{primaries:t,whitePoint:i,transfer:Sr,toXYZ:Dr,fromXYZ:Or,luminanceCoefficients:e,workingColorSpaceConfig:{unpackColorSpace:ne},outputColorSpaceConfig:{drawingBufferColorSpace:ne}},[ne]:{primaries:t,whitePoint:i,transfer:Ms,toXYZ:Dr,fromXYZ:Or,luminanceCoefficients:e,outputColorSpaceConfig:{drawingBufferColorSpace:ne}}}),n}const ae=Nn();function xe(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function je(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let Qe;class qn{static getDataURL(t,e="image/png"){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let i;if(t instanceof HTMLCanvasElement)i=t;else{Qe===void 0&&(Qe=Tr("canvas")),Qe.width=t.width,Qe.height=t.height;const s=Qe.getContext("2d");t instanceof ImageData?s.putImageData(t,0,0):s.drawImage(t,0,0,t.width,t.height),i=Qe}return i.toDataURL(e)}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=Tr("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const s=i.getImageData(0,0,t.width,t.height),r=s.data;for(let a=0;a<r.length;a++)r[a]=xe(r[a]/255)*255;return i.putImageData(s,0,0),e}else if(t.data){const e=t.data.slice(0);for(let i=0;i<e.length;i++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[i]=Math.floor(xe(e[i]/255)*255):e[i]=xe(e[i]);return{data:e,width:t.width,height:t.height}}else return Tt("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let Pn=0;class Un{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Pn++}),this.uuid=Fe(),this.data=t,this.dataReady=!0,this.version=0}getSize(t){const e=this.data;return typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?t.set(e.videoWidth,e.videoHeight,0):e instanceof VideoFrame?t.set(e.displayHeight,e.displayWidth,0):e!==null?t.set(e.width,e.height,e.depth||0):t.set(0,0,0),t}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const i={uuid:this.uuid,url:""},s=this.data;if(s!==null){let r;if(Array.isArray(s)){r=[];for(let a=0,h=s.length;a<h;a++)s[a].isDataTexture?r.push(As(s[a].image)):r.push(As(s[a]))}else r=As(s);i.url=r}return e||(t.images[this.uuid]=i),i}}function As(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?qn.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(Tt("Texture: Unable to serialize Texture."),{})}let Ln=0;const _s=new g;class Te extends Wi{constructor(t=Te.DEFAULT_IMAGE,e=Te.DEFAULT_MAPPING,i=Li,s=Li,r=Tn,a=Bn,h=In,o=kn,l=Te.DEFAULT_ANISOTROPY,c=Ar){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Ln++}),this.uuid=Fe(),this.name="",this.source=new Un(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=i,this.wrapT=s,this.magFilter=r,this.minFilter=a,this.anisotropy=l,this.format=h,this.internalFormat=null,this.type=o,this.offset=new At(0,0),this.repeat=new At(1,1),this.center=new At(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ce,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(t&&t.depth&&t.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(_s).x}get height(){return this.source.getSize(_s).y}get depth(){return this.source.getSize(_s).z}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.renderTarget=t.renderTarget,this.isRenderTargetTexture=t.isRenderTargetTexture,this.isArrayTexture=t.isArrayTexture,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}setValues(t){for(const e in t){const i=t[e];if(i===void 0){Tt(`Texture.setValues(): parameter '${e}' has value of undefined.`);continue}const s=this[e];if(s===void 0){Tt(`Texture.setValues(): property '${e}' does not exist.`);continue}s&&i&&s.isVector2&&i.isVector2||s&&i&&s.isVector3&&i.isVector3||s&&i&&s.isMatrix3&&i.isMatrix3?s.copy(i):this[e]=i}}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const i={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==br)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case wr:t.x=t.x-Math.floor(t.x);break;case Li:t.x=t.x<0?0:1;break;case vr:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case wr:t.y=t.y-Math.floor(t.y);break;case Li:t.y=t.y<0?0:1;break;case vr:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){t===!0&&this.pmremVersion++}}Te.DEFAULT_IMAGE=null,Te.DEFAULT_MAPPING=br,Te.DEFAULT_ANISOTROPY=1;class zi{constructor(t=0,e=0,i=0,s=1){zi.prototype.isVector4=!0,this.x=t,this.y=e,this.z=i,this.w=s}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,s){return this.x=t,this.y=e,this.z=i,this.w=s,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,s=this.z,r=this.w,a=t.elements;return this.x=a[0]*e+a[4]*i+a[8]*s+a[12]*r,this.y=a[1]*e+a[5]*i+a[9]*s+a[13]*r,this.z=a[2]*e+a[6]*i+a[10]*s+a[14]*r,this.w=a[3]*e+a[7]*i+a[11]*s+a[15]*r,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,s,r;const o=t.elements,l=o[0],c=o[4],d=o[8],m=o[1],f=o[5],p=o[9],x=o[2],M=o[6],y=o[10];if(Math.abs(c-m)<.01&&Math.abs(d-x)<.01&&Math.abs(p-M)<.01){if(Math.abs(c+m)<.1&&Math.abs(d+x)<.1&&Math.abs(p+M)<.1&&Math.abs(l+f+y-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const C=(l+1)/2,w=(f+1)/2,A=(y+1)/2,z=(c+m)/4,v=(d+x)/4,b=(p+M)/4;return C>w&&C>A?C<.01?(i=0,s=.707106781,r=.707106781):(i=Math.sqrt(C),s=z/i,r=v/i):w>A?w<.01?(i=.707106781,s=0,r=.707106781):(s=Math.sqrt(w),i=z/s,r=b/s):A<.01?(i=.707106781,s=.707106781,r=0):(r=Math.sqrt(A),i=v/r,s=b/r),this.set(i,s,r,e),this}let S=Math.sqrt((M-p)*(M-p)+(d-x)*(d-x)+(m-c)*(m-c));return Math.abs(S)<.001&&(S=1),this.x=(M-p)/S,this.y=(d-x)/S,this.z=(m-c)/S,this.w=Math.acos((l+f+y-1)/2),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=R(this.x,t.x,e.x),this.y=R(this.y,t.y,e.y),this.z=R(this.z,t.z,e.z),this.w=R(this.w,t.w,e.w),this}clampScalar(t,e){return this.x=R(this.x,t,e),this.y=R(this.y,t,e),this.z=R(this.z,t,e),this.w=R(this.w,t,e),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(R(i,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class bi{constructor(t=new g(1/0,1/0,1/0),e=new g(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e+=3)this.expandByPoint(he.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,i=t.count;e<i;e++)this.expandByPoint(he.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=he.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const i=t.geometry;if(i!==void 0){const r=i.getAttribute("position");if(e===!0&&r!==void 0&&t.isInstancedMesh!==!0)for(let a=0,h=r.count;a<h;a++)t.isMesh===!0?t.getVertexPosition(a,he):he.fromBufferAttribute(r,a),he.applyMatrix4(t.matrixWorld),this.expandByPoint(he);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),Vi.copy(t.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),Vi.copy(i.boundingBox)),Vi.applyMatrix4(t.matrixWorld),this.union(Vi)}const s=t.children;for(let r=0,a=s.length;r<a;r++)this.expandByObject(s[r],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,he),he.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(wi),Zi.subVectors(this.max,wi),Ke.subVectors(t.a,wi),ti.subVectors(t.b,wi),ei.subVectors(t.c,wi),Be.subVectors(ti,Ke),ke.subVectors(ei,ti),qe.subVectors(Ke,ei);let e=[0,-Be.z,Be.y,0,-ke.z,ke.y,0,-qe.z,qe.y,Be.z,0,-Be.x,ke.z,0,-ke.x,qe.z,0,-qe.x,-Be.y,Be.x,0,-ke.y,ke.x,0,-qe.y,qe.x,0];return!Ss(e,Ke,ti,ei,Zi)||(e=[1,0,0,0,1,0,0,0,1],!Ss(e,Ke,ti,ei,Zi))?!1:(Xi.crossVectors(Be,ke),e=[Xi.x,Xi.y,Xi.z],Ss(e,Ke,ti,ei,Zi))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,he).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(he).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(ye[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),ye[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),ye[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),ye[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),ye[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),ye[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),ye[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),ye[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(ye),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(t){return this.min.fromArray(t.min),this.max.fromArray(t.max),this}}const ye=[new g,new g,new g,new g,new g,new g,new g,new g],he=new g,Vi=new bi,Ke=new g,ti=new g,ei=new g,Be=new g,ke=new g,qe=new g,wi=new g,Zi=new g,Xi=new g,Pe=new g;function Ss(n,t,e,i,s){for(let r=0,a=n.length-3;r<=a;r+=3){Pe.fromArray(n,r);const h=s.x*Math.abs(Pe.x)+s.y*Math.abs(Pe.y)+s.z*Math.abs(Pe.z),o=t.dot(Pe),l=e.dot(Pe),c=i.dot(Pe);if(Math.max(-Math.max(o,l,c),Math.min(o,l,c))>h)return!1}return!0}const Rn=new bi,vi=new g,Fs=new g;class Cs{constructor(t=new g,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;e!==void 0?i.copy(e):Rn.setFromPoints(t).getCenter(i);let s=0;for(let r=0,a=t.length;r<a;r++)s=Math.max(s,i.distanceToSquared(t[r]));return this.radius=Math.sqrt(s),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;vi.subVectors(t,this.center);const e=vi.lengthSq();if(e>this.radius*this.radius){const i=Math.sqrt(e),s=(i-this.radius)*.5;this.center.addScaledVector(vi,s/i),this.radius+=s}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(Fs.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(vi.copy(t.center).add(Fs)),this.expandByPoint(vi.copy(t.center).sub(Fs))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(t){return this.radius=t.radius,this.center.fromArray(t.center),this}}const ge=new g,Ts=new g,Yi=new g,Ee=new g,Bs=new g,Ji=new g,ks=new g;class Nr{constructor(t=new g,e=new g(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,ge)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=ge.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(ge.copy(this.origin).addScaledVector(this.direction,e),ge.distanceToSquared(t))}distanceSqToSegment(t,e,i,s){Ts.copy(t).add(e).multiplyScalar(.5),Yi.copy(e).sub(t).normalize(),Ee.copy(this.origin).sub(Ts);const r=t.distanceTo(e)*.5,a=-this.direction.dot(Yi),h=Ee.dot(this.direction),o=-Ee.dot(Yi),l=Ee.lengthSq(),c=Math.abs(1-a*a);let d,m,f,p;if(c>0)if(d=a*o-h,m=a*h-o,p=r*c,d>=0)if(m>=-p)if(m<=p){const x=1/c;d*=x,m*=x,f=d*(d+a*m+2*h)+m*(a*d+m+2*o)+l}else m=r,d=Math.max(0,-(a*m+h)),f=-d*d+m*(m+2*o)+l;else m=-r,d=Math.max(0,-(a*m+h)),f=-d*d+m*(m+2*o)+l;else m<=-p?(d=Math.max(0,-(-a*r+h)),m=d>0?-r:Math.min(Math.max(-r,-o),r),f=-d*d+m*(m+2*o)+l):m<=p?(d=0,m=Math.min(Math.max(-r,-o),r),f=m*(m+2*o)+l):(d=Math.max(0,-(a*r+h)),m=d>0?r:Math.min(Math.max(-r,-o),r),f=-d*d+m*(m+2*o)+l);else m=a>0?-r:r,d=Math.max(0,-(a*m+h)),f=-d*d+m*(m+2*o)+l;return i&&i.copy(this.origin).addScaledVector(this.direction,d),s&&s.copy(Ts).addScaledVector(Yi,m),f}intersectSphere(t,e){ge.subVectors(t.center,this.origin);const i=ge.dot(this.direction),s=ge.dot(ge)-i*i,r=t.radius*t.radius;if(s>r)return null;const a=Math.sqrt(r-s),h=i-a,o=i+a;return o<0?null:h<0?this.at(o,e):this.at(h,e)}intersectsSphere(t){return t.radius<0?!1:this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return i===null?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,s,r,a,h,o;const l=1/this.direction.x,c=1/this.direction.y,d=1/this.direction.z,m=this.origin;return l>=0?(i=(t.min.x-m.x)*l,s=(t.max.x-m.x)*l):(i=(t.max.x-m.x)*l,s=(t.min.x-m.x)*l),c>=0?(r=(t.min.y-m.y)*c,a=(t.max.y-m.y)*c):(r=(t.max.y-m.y)*c,a=(t.min.y-m.y)*c),i>a||r>s||((r>i||isNaN(i))&&(i=r),(a<s||isNaN(s))&&(s=a),d>=0?(h=(t.min.z-m.z)*d,o=(t.max.z-m.z)*d):(h=(t.max.z-m.z)*d,o=(t.min.z-m.z)*d),i>o||h>s)||((h>i||i!==i)&&(i=h),(o<s||s!==s)&&(s=o),s<0)?null:this.at(i>=0?i:s,e)}intersectsBox(t){return this.intersectBox(t,ge)!==null}intersectTriangle(t,e,i,s,r){Bs.subVectors(e,t),Ji.subVectors(i,t),ks.crossVectors(Bs,Ji);let a=this.direction.dot(ks),h;if(a>0){if(s)return null;h=1}else if(a<0)h=-1,a=-a;else return null;Ee.subVectors(this.origin,t);const o=h*this.direction.dot(Ji.crossVectors(Ee,Ji));if(o<0)return null;const l=h*this.direction.dot(Bs.cross(Ee));if(l<0||o+l>a)return null;const c=-h*Ee.dot(ks);return c<0?null:this.at(c/a,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Zt{constructor(t,e,i,s,r,a,h,o,l,c,d,m,f,p,x,M){Zt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,i,s,r,a,h,o,l,c,d,m,f,p,x,M)}set(t,e,i,s,r,a,h,o,l,c,d,m,f,p,x,M){const y=this.elements;return y[0]=t,y[4]=e,y[8]=i,y[12]=s,y[1]=r,y[5]=a,y[9]=h,y[13]=o,y[2]=l,y[6]=c,y[10]=d,y[14]=m,y[3]=f,y[7]=p,y[11]=x,y[15]=M,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Zt().fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,s=1/ii.setFromMatrixColumn(t,0).length(),r=1/ii.setFromMatrixColumn(t,1).length(),a=1/ii.setFromMatrixColumn(t,2).length();return e[0]=i[0]*s,e[1]=i[1]*s,e[2]=i[2]*s,e[3]=0,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=0,e[8]=i[8]*a,e[9]=i[9]*a,e[10]=i[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,i=t.x,s=t.y,r=t.z,a=Math.cos(i),h=Math.sin(i),o=Math.cos(s),l=Math.sin(s),c=Math.cos(r),d=Math.sin(r);if(t.order==="XYZ"){const m=a*c,f=a*d,p=h*c,x=h*d;e[0]=o*c,e[4]=-o*d,e[8]=l,e[1]=f+p*l,e[5]=m-x*l,e[9]=-h*o,e[2]=x-m*l,e[6]=p+f*l,e[10]=a*o}else if(t.order==="YXZ"){const m=o*c,f=o*d,p=l*c,x=l*d;e[0]=m+x*h,e[4]=p*h-f,e[8]=a*l,e[1]=a*d,e[5]=a*c,e[9]=-h,e[2]=f*h-p,e[6]=x+m*h,e[10]=a*o}else if(t.order==="ZXY"){const m=o*c,f=o*d,p=l*c,x=l*d;e[0]=m-x*h,e[4]=-a*d,e[8]=p+f*h,e[1]=f+p*h,e[5]=a*c,e[9]=x-m*h,e[2]=-a*l,e[6]=h,e[10]=a*o}else if(t.order==="ZYX"){const m=a*c,f=a*d,p=h*c,x=h*d;e[0]=o*c,e[4]=p*l-f,e[8]=m*l+x,e[1]=o*d,e[5]=x*l+m,e[9]=f*l-p,e[2]=-l,e[6]=h*o,e[10]=a*o}else if(t.order==="YZX"){const m=a*o,f=a*l,p=h*o,x=h*l;e[0]=o*c,e[4]=x-m*d,e[8]=p*d+f,e[1]=d,e[5]=a*c,e[9]=-h*c,e[2]=-l*c,e[6]=f*d+p,e[10]=m-x*d}else if(t.order==="XZY"){const m=a*o,f=a*l,p=h*o,x=h*l;e[0]=o*c,e[4]=-d,e[8]=l*c,e[1]=m*d+x,e[5]=a*c,e[9]=f*d-p,e[2]=p*d-f,e[6]=h*c,e[10]=x*d+m}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Wn,t,Vn)}lookAt(t,e,i){const s=this.elements;return Xt.subVectors(t,e),Xt.lengthSq()===0&&(Xt.z=1),Xt.normalize(),Ie.crossVectors(i,Xt),Ie.lengthSq()===0&&(Math.abs(i.z)===1?Xt.x+=1e-4:Xt.z+=1e-4,Xt.normalize(),Ie.crossVectors(i,Xt)),Ie.normalize(),$i.crossVectors(Xt,Ie),s[0]=Ie.x,s[4]=$i.x,s[8]=Xt.x,s[1]=Ie.y,s[5]=$i.y,s[9]=Xt.y,s[2]=Ie.z,s[6]=$i.z,s[10]=Xt.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,r=this.elements,a=i[0],h=i[4],o=i[8],l=i[12],c=i[1],d=i[5],m=i[9],f=i[13],p=i[2],x=i[6],M=i[10],y=i[14],S=i[3],C=i[7],w=i[11],A=i[15],z=s[0],v=s[4],b=s[8],F=s[12],D=s[1],B=s[5],T=s[9],E=s[13],N=s[2],W=s[6],I=s[10],G=s[14],Y=s[3],V=s[7],st=s[11],U=s[15];return r[0]=a*z+h*D+o*N+l*Y,r[4]=a*v+h*B+o*W+l*V,r[8]=a*b+h*T+o*I+l*st,r[12]=a*F+h*E+o*G+l*U,r[1]=c*z+d*D+m*N+f*Y,r[5]=c*v+d*B+m*W+f*V,r[9]=c*b+d*T+m*I+f*st,r[13]=c*F+d*E+m*G+f*U,r[2]=p*z+x*D+M*N+y*Y,r[6]=p*v+x*B+M*W+y*V,r[10]=p*b+x*T+M*I+y*st,r[14]=p*F+x*E+M*G+y*U,r[3]=S*z+C*D+w*N+A*Y,r[7]=S*v+C*B+w*W+A*V,r[11]=S*b+C*T+w*I+A*st,r[15]=S*F+C*E+w*G+A*U,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],s=t[8],r=t[12],a=t[1],h=t[5],o=t[9],l=t[13],c=t[2],d=t[6],m=t[10],f=t[14],p=t[3],x=t[7],M=t[11],y=t[15];return p*(+r*o*d-s*l*d-r*h*m+i*l*m+s*h*f-i*o*f)+x*(+e*o*f-e*l*m+r*a*m-s*a*f+s*l*c-r*o*c)+M*(+e*l*d-e*h*f-r*a*d+i*a*f+r*h*c-i*l*c)+y*(-s*h*c-e*o*d+e*h*m+s*a*d-i*a*m+i*o*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const s=this.elements;return t.isVector3?(s[12]=t.x,s[13]=t.y,s[14]=t.z):(s[12]=t,s[13]=e,s[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],r=t[3],a=t[4],h=t[5],o=t[6],l=t[7],c=t[8],d=t[9],m=t[10],f=t[11],p=t[12],x=t[13],M=t[14],y=t[15],S=d*M*l-x*m*l+x*o*f-h*M*f-d*o*y+h*m*y,C=p*m*l-c*M*l-p*o*f+a*M*f+c*o*y-a*m*y,w=c*x*l-p*d*l+p*h*f-a*x*f-c*h*y+a*d*y,A=p*d*o-c*x*o-p*h*m+a*x*m+c*h*M-a*d*M,z=e*S+i*C+s*w+r*A;if(z===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const v=1/z;return t[0]=S*v,t[1]=(x*m*r-d*M*r-x*s*f+i*M*f+d*s*y-i*m*y)*v,t[2]=(h*M*r-x*o*r+x*s*l-i*M*l-h*s*y+i*o*y)*v,t[3]=(d*o*r-h*m*r-d*s*l+i*m*l+h*s*f-i*o*f)*v,t[4]=C*v,t[5]=(c*M*r-p*m*r+p*s*f-e*M*f-c*s*y+e*m*y)*v,t[6]=(p*o*r-a*M*r-p*s*l+e*M*l+a*s*y-e*o*y)*v,t[7]=(a*m*r-c*o*r+c*s*l-e*m*l-a*s*f+e*o*f)*v,t[8]=w*v,t[9]=(p*d*r-c*x*r-p*i*f+e*x*f+c*i*y-e*d*y)*v,t[10]=(a*x*r-p*h*r+p*i*l-e*x*l-a*i*y+e*h*y)*v,t[11]=(c*h*r-a*d*r-c*i*l+e*d*l+a*i*f-e*h*f)*v,t[12]=A*v,t[13]=(c*x*s-p*d*s+p*i*m-e*x*m-c*i*M+e*d*M)*v,t[14]=(p*h*s-a*x*s-p*i*o+e*x*o+a*i*M-e*h*M)*v,t[15]=(a*d*s-c*h*s+c*i*o-e*d*o-a*i*m+e*h*m)*v,this}scale(t){const e=this.elements,i=t.x,s=t.y,r=t.z;return e[0]*=i,e[4]*=s,e[8]*=r,e[1]*=i,e[5]*=s,e[9]*=r,e[2]*=i,e[6]*=s,e[10]*=r,e[3]*=i,e[7]*=s,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],s=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,s))}makeTranslation(t,e,i){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),s=Math.sin(e),r=1-i,a=t.x,h=t.y,o=t.z,l=r*a,c=r*h;return this.set(l*a+i,l*h-s*o,l*o+s*h,0,l*h+s*o,c*h+i,c*o-s*a,0,l*o-s*h,c*o+s*a,r*o*o+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,s,r,a){return this.set(1,i,r,0,t,1,a,0,e,s,1,0,0,0,0,1),this}compose(t,e,i){const s=this.elements,r=e._x,a=e._y,h=e._z,o=e._w,l=r+r,c=a+a,d=h+h,m=r*l,f=r*c,p=r*d,x=a*c,M=a*d,y=h*d,S=o*l,C=o*c,w=o*d,A=i.x,z=i.y,v=i.z;return s[0]=(1-(x+y))*A,s[1]=(f+w)*A,s[2]=(p-C)*A,s[3]=0,s[4]=(f-w)*z,s[5]=(1-(m+y))*z,s[6]=(M+S)*z,s[7]=0,s[8]=(p+C)*v,s[9]=(M-S)*v,s[10]=(1-(m+x))*v,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this}decompose(t,e,i){const s=this.elements;let r=ii.set(s[0],s[1],s[2]).length();const a=ii.set(s[4],s[5],s[6]).length(),h=ii.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),t.x=s[12],t.y=s[13],t.z=s[14],oe.copy(this);const l=1/r,c=1/a,d=1/h;return oe.elements[0]*=l,oe.elements[1]*=l,oe.elements[2]*=l,oe.elements[4]*=c,oe.elements[5]*=c,oe.elements[6]*=c,oe.elements[8]*=d,oe.elements[9]*=d,oe.elements[10]*=d,e.setFromRotationMatrix(oe),i.x=r,i.y=a,i.z=h,this}makePerspective(t,e,i,s,r,a,h=Ri,o=!1){const l=this.elements,c=2*r/(e-t),d=2*r/(i-s),m=(e+t)/(e-t),f=(i+s)/(i-s);let p,x;if(o)p=r/(a-r),x=a*r/(a-r);else if(h===Ri)p=-(a+r)/(a-r),x=-2*a*r/(a-r);else if(h===Cr)p=-a/(a-r),x=-a*r/(a-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+h);return l[0]=c,l[4]=0,l[8]=m,l[12]=0,l[1]=0,l[5]=d,l[9]=f,l[13]=0,l[2]=0,l[6]=0,l[10]=p,l[14]=x,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(t,e,i,s,r,a,h=Ri,o=!1){const l=this.elements,c=2/(e-t),d=2/(i-s),m=-(e+t)/(e-t),f=-(i+s)/(i-s);let p,x;if(o)p=1/(a-r),x=a/(a-r);else if(h===Ri)p=-2/(a-r),x=-(a+r)/(a-r);else if(h===Cr)p=-1/(a-r),x=-r/(a-r);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+h);return l[0]=c,l[4]=0,l[8]=0,l[12]=m,l[1]=0,l[5]=d,l[9]=0,l[13]=f,l[2]=0,l[6]=0,l[10]=p,l[14]=x,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let s=0;s<16;s++)if(e[s]!==i[s])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}const ii=new g,oe=new Zt,Wn=new g(0,0,0),Vn=new g(1,1,1),Ie=new g,$i=new g,Xt=new g,qr=new Zt,Pr=new Mi;class Ai{constructor(t=0,e=0,i=0,s=Ai.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=s}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,s=this._order){return this._x=t,this._y=e,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const s=t.elements,r=s[0],a=s[4],h=s[8],o=s[1],l=s[5],c=s[9],d=s[2],m=s[6],f=s[10];switch(e){case"XYZ":this._y=Math.asin(R(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-c,f),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(m,l),this._z=0);break;case"YXZ":this._x=Math.asin(-R(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(h,f),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-d,r),this._z=0);break;case"ZXY":this._x=Math.asin(R(m,-1,1)),Math.abs(m)<.9999999?(this._y=Math.atan2(-d,f),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-R(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(m,f),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(R(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-d,r)):(this._x=0,this._y=Math.atan2(h,f));break;case"XZY":this._z=Math.asin(-R(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(m,l),this._y=Math.atan2(h,r)):(this._x=Math.atan2(-c,f),this._y=0);break;default:Tt("Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,i===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return qr.makeRotationFromQuaternion(t),this.setFromRotationMatrix(qr,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Pr.setFromEuler(this),this.setFromQuaternion(Pr,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Ai.DEFAULT_ORDER="XYZ";class Zn{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let Xn=0;const Ur=new g,si=new Mi,Me=new Zt,Hi=new g,_i=new g,Yn=new g,Jn=new Mi,Lr=new g(1,0,0),Rr=new g(0,1,0),Wr=new g(0,0,1),Vr={type:"added"},$n={type:"removed"},ri={type:"childadded",child:null},Es={type:"childremoved",child:null};class Yt extends Wi{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Xn++}),this.uuid=Fe(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Yt.DEFAULT_UP.clone();const t=new g,e=new Ai,i=new Mi,s=new g(1,1,1);function r(){i.setFromEuler(e,!1)}function a(){e.setFromQuaternion(i,void 0,!1)}e._onChange(r),i._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Zt},normalMatrix:{value:new Ce}}),this.matrix=new Zt,this.matrixWorld=new Zt,this.matrixAutoUpdate=Yt.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Yt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Zn,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return si.setFromAxisAngle(t,e),this.quaternion.multiply(si),this}rotateOnWorldAxis(t,e){return si.setFromAxisAngle(t,e),this.quaternion.premultiply(si),this}rotateX(t){return this.rotateOnAxis(Lr,t)}rotateY(t){return this.rotateOnAxis(Rr,t)}rotateZ(t){return this.rotateOnAxis(Wr,t)}translateOnAxis(t,e){return Ur.copy(t).applyQuaternion(this.quaternion),this.position.add(Ur.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Lr,t)}translateY(t){return this.translateOnAxis(Rr,t)}translateZ(t){return this.translateOnAxis(Wr,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Me.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?Hi.copy(t):Hi.set(t,e,i);const s=this.parent;this.updateWorldMatrix(!0,!1),_i.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Me.lookAt(_i,Hi,this.up):Me.lookAt(Hi,_i,this.up),this.quaternion.setFromRotationMatrix(Me),s&&(Me.extractRotation(s.matrixWorld),si.setFromRotationMatrix(Me),this.quaternion.premultiply(si.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(Se("Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(Vr),ri.child=t,this.dispatchEvent(ri),ri.child=null):Se("Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent($n),Es.child=t,this.dispatchEvent(Es),Es.child=null),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),Me.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),Me.multiply(t.parent.matrixWorld)),t.applyMatrix4(Me),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(Vr),ri.child=t,this.dispatchEvent(ri),ri.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,s=this.children.length;i<s;i++){const a=this.children[i].getObjectByProperty(t,e);if(a!==void 0)return a}}getObjectsByProperty(t,e,i=[]){this[t]===e&&i.push(this);const s=this.children;for(let r=0,a=s.length;r<a;r++)s[r].getObjectsByProperty(t,e,i);return i}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_i,t,Yn),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_i,Jn,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].updateMatrixWorld(t)}updateWorldMatrix(t,e){const i=this.parent;if(t===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),e===!0){const s=this.children;for(let r=0,a=s.length;r<a;r++)s[r].updateWorldMatrix(!1,!0)}}toJSON(t){const e=t===void 0||typeof t=="string",i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.geometryInfo=this._geometryInfo.map(h=>({...h,boundingBox:h.boundingBox?h.boundingBox.toJSON():void 0,boundingSphere:h.boundingSphere?h.boundingSphere.toJSON():void 0})),s.instanceInfo=this._instanceInfo.map(h=>({...h})),s.availableInstanceIds=this._availableInstanceIds.slice(),s.availableGeometryIds=this._availableGeometryIds.slice(),s.nextIndexStart=this._nextIndexStart,s.nextVertexStart=this._nextVertexStart,s.geometryCount=this._geometryCount,s.maxInstanceCount=this._maxInstanceCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.matricesTexture=this._matricesTexture.toJSON(t),s.indirectTexture=this._indirectTexture.toJSON(t),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(t)),this.boundingSphere!==null&&(s.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(s.boundingBox=this.boundingBox.toJSON()));function r(h,o){return h[o.uuid]===void 0&&(h[o.uuid]=o.toJSON(t)),o.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=r(t.geometries,this.geometry);const h=this.geometry.parameters;if(h!==void 0&&h.shapes!==void 0){const o=h.shapes;if(Array.isArray(o))for(let l=0,c=o.length;l<c;l++){const d=o[l];r(t.shapes,d)}else r(t.shapes,o)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(t.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const h=[];for(let o=0,l=this.material.length;o<l;o++)h.push(r(t.materials,this.material[o]));s.material=h}else s.material=r(t.materials,this.material);if(this.children.length>0){s.children=[];for(let h=0;h<this.children.length;h++)s.children.push(this.children[h].toJSON(t).object)}if(this.animations.length>0){s.animations=[];for(let h=0;h<this.animations.length;h++){const o=this.animations[h];s.animations.push(r(t.animations,o))}}if(e){const h=a(t.geometries),o=a(t.materials),l=a(t.textures),c=a(t.images),d=a(t.shapes),m=a(t.skeletons),f=a(t.animations),p=a(t.nodes);h.length>0&&(i.geometries=h),o.length>0&&(i.materials=o),l.length>0&&(i.textures=l),c.length>0&&(i.images=c),d.length>0&&(i.shapes=d),m.length>0&&(i.skeletons=m),f.length>0&&(i.animations=f),p.length>0&&(i.nodes=p)}return i.object=s,i;function a(h){const o=[];for(const l in h){const c=h[l];delete c.metadata,o.push(c)}return o}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let i=0;i<t.children.length;i++){const s=t.children[i];this.add(s.clone())}return this}}Yt.DEFAULT_UP=new g(0,1,0),Yt.DEFAULT_MATRIX_AUTO_UPDATE=!0,Yt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const le=new g,ze=new g,Is=new g,be=new g,ni=new g,ai=new g,Zr=new g,Ds=new g,Os=new g,Ns=new g,qs=new zi,Ps=new zi,Us=new zi;class Qt{constructor(t=new g,e=new g,i=new g){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,s){s.subVectors(i,e),le.subVectors(t,e),s.cross(le);const r=s.lengthSq();return r>0?s.multiplyScalar(1/Math.sqrt(r)):s.set(0,0,0)}static getBarycoord(t,e,i,s,r){le.subVectors(s,e),ze.subVectors(i,e),Is.subVectors(t,e);const a=le.dot(le),h=le.dot(ze),o=le.dot(Is),l=ze.dot(ze),c=ze.dot(Is),d=a*l-h*h;if(d===0)return r.set(0,0,0),null;const m=1/d,f=(l*o-h*c)*m,p=(a*c-h*o)*m;return r.set(1-f-p,p,f)}static containsPoint(t,e,i,s){return this.getBarycoord(t,e,i,s,be)===null?!1:be.x>=0&&be.y>=0&&be.x+be.y<=1}static getInterpolation(t,e,i,s,r,a,h,o){return this.getBarycoord(t,e,i,s,be)===null?(o.x=0,o.y=0,"z"in o&&(o.z=0),"w"in o&&(o.w=0),null):(o.setScalar(0),o.addScaledVector(r,be.x),o.addScaledVector(a,be.y),o.addScaledVector(h,be.z),o)}static getInterpolatedAttribute(t,e,i,s,r,a){return qs.setScalar(0),Ps.setScalar(0),Us.setScalar(0),qs.fromBufferAttribute(t,e),Ps.fromBufferAttribute(t,i),Us.fromBufferAttribute(t,s),a.setScalar(0),a.addScaledVector(qs,r.x),a.addScaledVector(Ps,r.y),a.addScaledVector(Us,r.z),a}static isFrontFacing(t,e,i,s){return le.subVectors(i,e),ze.subVectors(t,e),le.cross(ze).dot(s)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,s){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[s]),this}setFromAttributeAndIndices(t,e,i,s){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,s),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return le.subVectors(this.c,this.b),ze.subVectors(this.a,this.b),le.cross(ze).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Qt.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Qt.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,i,s,r){return Qt.getInterpolation(t,this.a,this.b,this.c,e,i,s,r)}containsPoint(t){return Qt.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Qt.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,s=this.b,r=this.c;let a,h;ni.subVectors(s,i),ai.subVectors(r,i),Ds.subVectors(t,i);const o=ni.dot(Ds),l=ai.dot(Ds);if(o<=0&&l<=0)return e.copy(i);Os.subVectors(t,s);const c=ni.dot(Os),d=ai.dot(Os);if(c>=0&&d<=c)return e.copy(s);const m=o*d-c*l;if(m<=0&&o>=0&&c<=0)return a=o/(o-c),e.copy(i).addScaledVector(ni,a);Ns.subVectors(t,r);const f=ni.dot(Ns),p=ai.dot(Ns);if(p>=0&&f<=p)return e.copy(r);const x=f*l-o*p;if(x<=0&&l>=0&&p<=0)return h=l/(l-p),e.copy(i).addScaledVector(ai,h);const M=c*p-f*d;if(M<=0&&d-c>=0&&f-p>=0)return Zr.subVectors(r,s),h=(d-c)/(d-c+(f-p)),e.copy(s).addScaledVector(Zr,h);const y=1/(M+x+m);return a=x*y,h=m*y,e.copy(i).addScaledVector(ni,a).addScaledVector(ai,h)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const Xr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},De={h:0,s:0,l:0},Gi={h:0,s:0,l:0};function Ls(n,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?n+(t-n)*6*e:e<1/2?t:e<2/3?n+(t-n)*6*(2/3-e):n}class hi{constructor(t,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,i)}set(t,e,i){if(e===void 0&&i===void 0){const s=t;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(t,e,i);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=ne){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,ae.colorSpaceToWorking(this,e),this}setRGB(t,e,i,s=ae.workingColorSpace){return this.r=t,this.g=e,this.b=i,ae.colorSpaceToWorking(this,s),this}setHSL(t,e,i,s=ae.workingColorSpace){if(t=On(t,1),e=R(e,0,1),i=R(i,0,1),e===0)this.r=this.g=this.b=i;else{const r=i<=.5?i*(1+e):i+e-i*e,a=2*i-r;this.r=Ls(a,r,t+1/3),this.g=Ls(a,r,t),this.b=Ls(a,r,t-1/3)}return ae.colorSpaceToWorking(this,s),this}setStyle(t,e=ne){function i(r){r!==void 0&&parseFloat(r)<1&&Tt("Color: Alpha component of "+t+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(t)){let r;const a=s[1],h=s[2];switch(a){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(h))return i(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,e);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(h))return i(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,e);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(h))return i(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,e);break;default:Tt("Color: Unknown color model "+t)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(t)){const r=s[1],a=r.length;if(a===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,e);if(a===6)return this.setHex(parseInt(r,16),e);Tt("Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=ne){const i=Xr[t.toLowerCase()];return i!==void 0?this.setHex(i,e):Tt("Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=xe(t.r),this.g=xe(t.g),this.b=xe(t.b),this}copyLinearToSRGB(t){return this.r=je(t.r),this.g=je(t.g),this.b=je(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=ne){return ae.workingToColorSpace(It.copy(this),t),Math.round(R(It.r*255,0,255))*65536+Math.round(R(It.g*255,0,255))*256+Math.round(R(It.b*255,0,255))}getHexString(t=ne){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=ae.workingColorSpace){ae.workingToColorSpace(It.copy(this),e);const i=It.r,s=It.g,r=It.b,a=Math.max(i,s,r),h=Math.min(i,s,r);let o,l;const c=(h+a)/2;if(h===a)o=0,l=0;else{const d=a-h;switch(l=c<=.5?d/(a+h):d/(2-a-h),a){case i:o=(s-r)/d+(s<r?6:0);break;case s:o=(r-i)/d+2;break;case r:o=(i-s)/d+4;break}o/=6}return t.h=o,t.s=l,t.l=c,t}getRGB(t,e=ae.workingColorSpace){return ae.workingToColorSpace(It.copy(this),e),t.r=It.r,t.g=It.g,t.b=It.b,t}getStyle(t=ne){ae.workingToColorSpace(It.copy(this),t);const e=It.r,i=It.g,s=It.b;return t!==ne?`color(${t} ${e.toFixed(3)} ${i.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(i*255)},${Math.round(s*255)})`}offsetHSL(t,e,i){return this.getHSL(De),this.setHSL(De.h+t,De.s+e,De.l+i)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(De),t.getHSL(Gi);const i=bs(De.h,Gi.h,e),s=bs(De.s,Gi.s,e),r=bs(De.l,Gi.l,e);return this.setHSL(i,s,r),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,i=this.g,s=this.b,r=t.elements;return this.r=r[0]*e+r[3]*i+r[6]*s,this.g=r[1]*e+r[4]*i+r[7]*s,this.b=r[2]*e+r[5]*i+r[8]*s,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const It=new hi;hi.NAMES=Xr;let Hn=0;class Rs extends Wi{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Hn++}),this.uuid=Fe(),this.name="",this.type="Material",this.blending=xr,this.side=gs,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=gr,this.blendDst=Mr,this.blendEquation=yr,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new hi(0,0,0),this.blendAlpha=0,this.depthFunc=zr,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Fr,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Ge,this.stencilZFail=Ge,this.stencilZPass=Ge,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const e in t){const i=t[e];if(i===void 0){Tt(`Material: parameter '${e}' has value of undefined.`);continue}const s=this[e];if(s===void 0){Tt(`Material: '${e}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(i):s&&s.isVector3&&i&&i.isVector3?s.copy(i):this[e]=i}}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});const i={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(i.sheenColorMap=this.sheenColorMap.toJSON(t).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(i.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(t).uuid),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==xr&&(i.blending=this.blending),this.side!==gs&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==gr&&(i.blendSrc=this.blendSrc),this.blendDst!==Mr&&(i.blendDst=this.blendDst),this.blendEquation!==yr&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==zr&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Fr&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Ge&&(i.stencilFail=this.stencilFail),this.stencilZFail!==Ge&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==Ge&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function s(r){const a=[];for(const h in r){const o=r[h];delete o.metadata,a.push(o)}return a}if(e){const r=s(t.textures),a=s(t.images);r.length>0&&(i.textures=r),a.length>0&&(i.images=a)}return i}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(e!==null){const s=e.length;i=new Array(s);for(let r=0;r!==s;++r)i[r]=e[r].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}}class Yr extends Rs{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new hi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ai,this.combine=Cn,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const gt=new g,ji=new At;let Gn=0;class Ue{constructor(t,e,i=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:Gn++}),this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=i,this.usage=zs,this.updateRanges=[],this.gpuType=En,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let s=0,r=this.itemSize;s<r;s++)this.array[t+s]=e.array[i+s];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,i=this.count;e<i;e++)ji.fromBufferAttribute(this,e),ji.applyMatrix3(t),this.setXY(e,ji.x,ji.y);else if(this.itemSize===3)for(let e=0,i=this.count;e<i;e++)gt.fromBufferAttribute(this,e),gt.applyMatrix3(t),this.setXYZ(e,gt.x,gt.y,gt.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)gt.fromBufferAttribute(this,e),gt.applyMatrix4(t),this.setXYZ(e,gt.x,gt.y,gt.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)gt.fromBufferAttribute(this,e),gt.applyNormalMatrix(t),this.setXYZ(e,gt.x,gt.y,gt.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)gt.fromBufferAttribute(this,e),gt.transformDirection(t),this.setXYZ(e,gt.x,gt.y,gt.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let i=this.array[t*this.itemSize+e];return this.normalized&&(i=fe(i,this.array)),i}setComponent(t,e,i){return this.normalized&&(i=et(i,this.array)),this.array[t*this.itemSize+e]=i,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=fe(e,this.array)),e}setX(t,e){return this.normalized&&(e=et(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=fe(e,this.array)),e}setY(t,e){return this.normalized&&(e=et(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=fe(e,this.array)),e}setZ(t,e){return this.normalized&&(e=et(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=fe(e,this.array)),e}setW(t,e){return this.normalized&&(e=et(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.normalized&&(e=et(e,this.array),i=et(i,this.array)),this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,s){return t*=this.itemSize,this.normalized&&(e=et(e,this.array),i=et(i,this.array),s=et(s,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=s,this}setXYZW(t,e,i,s,r){return t*=this.itemSize,this.normalized&&(e=et(e,this.array),i=et(i,this.array),s=et(s,this.array),r=et(r,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=s,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==zs&&(t.usage=this.usage),t}}class jn extends Ue{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class Qn extends Ue{constructor(t,e,i){super(new Uint32Array(t),e,i)}}class oi extends Ue{constructor(t,e,i){super(new Float32Array(t),e,i)}}let Kn=0;const Kt=new Zt,Ws=new Yt,li=new g,Jt=new bi,Si=new bi,Ft=new g;class Le extends Wi{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Kn++}),this.uuid=Fe(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Dn(t)?Qn:jn)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const r=new Ce().getNormalMatrix(t);i.applyNormalMatrix(r),i.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(t),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return Kt.makeRotationFromQuaternion(t),this.applyMatrix4(Kt),this}rotateX(t){return Kt.makeRotationX(t),this.applyMatrix4(Kt),this}rotateY(t){return Kt.makeRotationY(t),this.applyMatrix4(Kt),this}rotateZ(t){return Kt.makeRotationZ(t),this.applyMatrix4(Kt),this}translate(t,e,i){return Kt.makeTranslation(t,e,i),this.applyMatrix4(Kt),this}scale(t,e,i){return Kt.makeScale(t,e,i),this.applyMatrix4(Kt),this}lookAt(t){return Ws.lookAt(t),Ws.updateMatrix(),this.applyMatrix4(Ws.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(li).negate(),this.translate(li.x,li.y,li.z),this}setFromPoints(t){const e=this.getAttribute("position");if(e===void 0){const i=[];for(let s=0,r=t.length;s<r;s++){const a=t[s];i.push(a.x,a.y,a.z||0)}this.setAttribute("position",new oi(i,3))}else{const i=Math.min(t.length,e.count);for(let s=0;s<i;s++){const r=t[s];e.setXYZ(s,r.x,r.y,r.z||0)}t.length>e.count&&Tt("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),e.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new bi);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){Se("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new g(-1/0,-1/0,-1/0),new g(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let i=0,s=e.length;i<s;i++){const r=e[i];Jt.setFromBufferAttribute(r),this.morphTargetsRelative?(Ft.addVectors(this.boundingBox.min,Jt.min),this.boundingBox.expandByPoint(Ft),Ft.addVectors(this.boundingBox.max,Jt.max),this.boundingBox.expandByPoint(Ft)):(this.boundingBox.expandByPoint(Jt.min),this.boundingBox.expandByPoint(Jt.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&Se('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Cs);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){Se("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new g,1/0);return}if(t){const i=this.boundingSphere.center;if(Jt.setFromBufferAttribute(t),e)for(let r=0,a=e.length;r<a;r++){const h=e[r];Si.setFromBufferAttribute(h),this.morphTargetsRelative?(Ft.addVectors(Jt.min,Si.min),Jt.expandByPoint(Ft),Ft.addVectors(Jt.max,Si.max),Jt.expandByPoint(Ft)):(Jt.expandByPoint(Si.min),Jt.expandByPoint(Si.max))}Jt.getCenter(i);let s=0;for(let r=0,a=t.count;r<a;r++)Ft.fromBufferAttribute(t,r),s=Math.max(s,i.distanceToSquared(Ft));if(e)for(let r=0,a=e.length;r<a;r++){const h=e[r],o=this.morphTargetsRelative;for(let l=0,c=h.count;l<c;l++)Ft.fromBufferAttribute(h,l),o&&(li.fromBufferAttribute(t,l),Ft.add(li)),s=Math.max(s,i.distanceToSquared(Ft))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&Se('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){Se("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=e.position,s=e.normal,r=e.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Ue(new Float32Array(4*i.count),4));const a=this.getAttribute("tangent"),h=[],o=[];for(let b=0;b<i.count;b++)h[b]=new g,o[b]=new g;const l=new g,c=new g,d=new g,m=new At,f=new At,p=new At,x=new g,M=new g;function y(b,F,D){l.fromBufferAttribute(i,b),c.fromBufferAttribute(i,F),d.fromBufferAttribute(i,D),m.fromBufferAttribute(r,b),f.fromBufferAttribute(r,F),p.fromBufferAttribute(r,D),c.sub(l),d.sub(l),f.sub(m),p.sub(m);const B=1/(f.x*p.y-p.x*f.y);isFinite(B)&&(x.copy(c).multiplyScalar(p.y).addScaledVector(d,-f.y).multiplyScalar(B),M.copy(d).multiplyScalar(f.x).addScaledVector(c,-p.x).multiplyScalar(B),h[b].add(x),h[F].add(x),h[D].add(x),o[b].add(M),o[F].add(M),o[D].add(M))}let S=this.groups;S.length===0&&(S=[{start:0,count:t.count}]);for(let b=0,F=S.length;b<F;++b){const D=S[b],B=D.start,T=D.count;for(let E=B,N=B+T;E<N;E+=3)y(t.getX(E+0),t.getX(E+1),t.getX(E+2))}const C=new g,w=new g,A=new g,z=new g;function v(b){A.fromBufferAttribute(s,b),z.copy(A);const F=h[b];C.copy(F),C.sub(A.multiplyScalar(A.dot(F))).normalize(),w.crossVectors(z,F);const B=w.dot(o[b])<0?-1:1;a.setXYZW(b,C.x,C.y,C.z,B)}for(let b=0,F=S.length;b<F;++b){const D=S[b],B=D.start,T=D.count;for(let E=B,N=B+T;E<N;E+=3)v(t.getX(E+0)),v(t.getX(E+1)),v(t.getX(E+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Ue(new Float32Array(e.count*3),3),this.setAttribute("normal",i);else for(let m=0,f=i.count;m<f;m++)i.setXYZ(m,0,0,0);const s=new g,r=new g,a=new g,h=new g,o=new g,l=new g,c=new g,d=new g;if(t)for(let m=0,f=t.count;m<f;m+=3){const p=t.getX(m+0),x=t.getX(m+1),M=t.getX(m+2);s.fromBufferAttribute(e,p),r.fromBufferAttribute(e,x),a.fromBufferAttribute(e,M),c.subVectors(a,r),d.subVectors(s,r),c.cross(d),h.fromBufferAttribute(i,p),o.fromBufferAttribute(i,x),l.fromBufferAttribute(i,M),h.add(c),o.add(c),l.add(c),i.setXYZ(p,h.x,h.y,h.z),i.setXYZ(x,o.x,o.y,o.z),i.setXYZ(M,l.x,l.y,l.z)}else for(let m=0,f=e.count;m<f;m+=3)s.fromBufferAttribute(e,m+0),r.fromBufferAttribute(e,m+1),a.fromBufferAttribute(e,m+2),c.subVectors(a,r),d.subVectors(s,r),c.cross(d),i.setXYZ(m+0,c.x,c.y,c.z),i.setXYZ(m+1,c.x,c.y,c.z),i.setXYZ(m+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)Ft.fromBufferAttribute(t,e),Ft.normalize(),t.setXYZ(e,Ft.x,Ft.y,Ft.z)}toNonIndexed(){function t(h,o){const l=h.array,c=h.itemSize,d=h.normalized,m=new l.constructor(o.length*c);let f=0,p=0;for(let x=0,M=o.length;x<M;x++){h.isInterleavedBufferAttribute?f=o[x]*h.data.stride+h.offset:f=o[x]*c;for(let y=0;y<c;y++)m[p++]=l[f++]}return new Ue(m,c,d)}if(this.index===null)return Tt("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Le,i=this.index.array,s=this.attributes;for(const h in s){const o=s[h],l=t(o,i);e.setAttribute(h,l)}const r=this.morphAttributes;for(const h in r){const o=[],l=r[h];for(let c=0,d=l.length;c<d;c++){const m=l[c],f=t(m,i);o.push(f)}e.morphAttributes[h]=o}e.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let h=0,o=a.length;h<o;h++){const l=a[h];e.addGroup(l.start,l.count,l.materialIndex)}return e}toJSON(){const t={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const o=this.parameters;for(const l in o)o[l]!==void 0&&(t[l]=o[l]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const o in i){const l=i[o];t.data.attributes[o]=l.toJSON(t.data)}const s={};let r=!1;for(const o in this.morphAttributes){const l=this.morphAttributes[o],c=[];for(let d=0,m=l.length;d<m;d++){const f=l[d];c.push(f.toJSON(t.data))}c.length>0&&(s[o]=c,r=!0)}r&&(t.data.morphAttributes=s,t.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));const h=this.boundingSphere;return h!==null&&(t.data.boundingSphere=h.toJSON()),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;i!==null&&this.setIndex(i.clone());const s=t.attributes;for(const l in s){const c=s[l];this.setAttribute(l,c.clone(e))}const r=t.morphAttributes;for(const l in r){const c=[],d=r[l];for(let m=0,f=d.length;m<f;m++)c.push(d[m].clone(e));this.morphAttributes[l]=c}this.morphTargetsRelative=t.morphTargetsRelative;const a=t.groups;for(let l=0,c=a.length;l<c;l++){const d=a[l];this.addGroup(d.start,d.count,d.materialIndex)}const h=t.boundingBox;h!==null&&(this.boundingBox=h.clone());const o=t.boundingSphere;return o!==null&&(this.boundingSphere=o.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Jr=new Zt,Re=new Nr,Qi=new Cs,$r=new g,Ki=new g,ts=new g,es=new g,Vs=new g,is=new g,Hr=new g,ss=new g;class ta extends Yt{constructor(t=new Le,e=new Yr){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const s=e[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=s.length;r<a;r++){const h=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[h]=r}}}}getVertexPosition(t,e){const i=this.geometry,s=i.attributes.position,r=i.morphAttributes.position,a=i.morphTargetsRelative;e.fromBufferAttribute(s,t);const h=this.morphTargetInfluences;if(r&&h){is.set(0,0,0);for(let o=0,l=r.length;o<l;o++){const c=h[o],d=r[o];c!==0&&(Vs.fromBufferAttribute(d,t),a?is.addScaledVector(Vs,c):is.addScaledVector(Vs.sub(e),c))}e.add(is)}return e}raycast(t,e){const i=this.geometry,s=this.material,r=this.matrixWorld;s!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),Qi.copy(i.boundingSphere),Qi.applyMatrix4(r),Re.copy(t.ray).recast(t.near),!(Qi.containsPoint(Re.origin)===!1&&(Re.intersectSphere(Qi,$r)===null||Re.origin.distanceToSquared($r)>(t.far-t.near)**2))&&(Jr.copy(r).invert(),Re.copy(t.ray).applyMatrix4(Jr),!(i.boundingBox!==null&&Re.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(t,e,Re)))}_computeIntersections(t,e,i){let s;const r=this.geometry,a=this.material,h=r.index,o=r.attributes.position,l=r.attributes.uv,c=r.attributes.uv1,d=r.attributes.normal,m=r.groups,f=r.drawRange;if(h!==null)if(Array.isArray(a))for(let p=0,x=m.length;p<x;p++){const M=m[p],y=a[M.materialIndex],S=Math.max(M.start,f.start),C=Math.min(h.count,Math.min(M.start+M.count,f.start+f.count));for(let w=S,A=C;w<A;w+=3){const z=h.getX(w),v=h.getX(w+1),b=h.getX(w+2);s=rs(this,y,t,i,l,c,d,z,v,b),s&&(s.faceIndex=Math.floor(w/3),s.face.materialIndex=M.materialIndex,e.push(s))}}else{const p=Math.max(0,f.start),x=Math.min(h.count,f.start+f.count);for(let M=p,y=x;M<y;M+=3){const S=h.getX(M),C=h.getX(M+1),w=h.getX(M+2);s=rs(this,a,t,i,l,c,d,S,C,w),s&&(s.faceIndex=Math.floor(M/3),e.push(s))}}else if(o!==void 0)if(Array.isArray(a))for(let p=0,x=m.length;p<x;p++){const M=m[p],y=a[M.materialIndex],S=Math.max(M.start,f.start),C=Math.min(o.count,Math.min(M.start+M.count,f.start+f.count));for(let w=S,A=C;w<A;w+=3){const z=w,v=w+1,b=w+2;s=rs(this,y,t,i,l,c,d,z,v,b),s&&(s.faceIndex=Math.floor(w/3),s.face.materialIndex=M.materialIndex,e.push(s))}}else{const p=Math.max(0,f.start),x=Math.min(o.count,f.start+f.count);for(let M=p,y=x;M<y;M+=3){const S=M,C=M+1,w=M+2;s=rs(this,a,t,i,l,c,d,S,C,w),s&&(s.faceIndex=Math.floor(M/3),e.push(s))}}}}function ea(n,t,e,i,s,r,a,h){let o;if(t.side===Fn?o=i.intersectTriangle(a,r,s,!0,h):o=i.intersectTriangle(s,r,a,t.side===gs,h),o===null)return null;ss.copy(h),ss.applyMatrix4(n.matrixWorld);const l=e.ray.origin.distanceTo(ss);return l<e.near||l>e.far?null:{distance:l,point:ss.clone(),object:n}}function rs(n,t,e,i,s,r,a,h,o,l){n.getVertexPosition(h,Ki),n.getVertexPosition(o,ts),n.getVertexPosition(l,es);const c=ea(n,t,e,i,Ki,ts,es,Hr);if(c){const d=new g;Qt.getBarycoord(Hr,Ki,ts,es,d),s&&(c.uv=Qt.getInterpolatedAttribute(s,h,o,l,d,new At)),r&&(c.uv1=Qt.getInterpolatedAttribute(r,h,o,l,d,new At)),a&&(c.normal=Qt.getInterpolatedAttribute(a,h,o,l,d,new g),c.normal.dot(i.direction)>0&&c.normal.multiplyScalar(-1));const m={a:h,b:o,c:l,normal:new g,materialIndex:0};Qt.getNormal(Ki,ts,es,m.normal),c.face=m,c.barycoord=d}return c}class Fi extends Yt{constructor(){super(),this.isGroup=!0,this.type="Group"}}class ia{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.usage=zs,this.updateRanges=[],this.version=0,this.uuid=Fe()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let s=0,r=this.stride;s<r;s++)this.array[t+s]=e.array[i+s];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Fe()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Fe()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Pt=new g;class ns{constructor(t,e,i,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)Pt.fromBufferAttribute(this,e),Pt.applyMatrix4(t),this.setXYZ(e,Pt.x,Pt.y,Pt.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)Pt.fromBufferAttribute(this,e),Pt.applyNormalMatrix(t),this.setXYZ(e,Pt.x,Pt.y,Pt.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)Pt.fromBufferAttribute(this,e),Pt.transformDirection(t),this.setXYZ(e,Pt.x,Pt.y,Pt.z);return this}getComponent(t,e){let i=this.array[t*this.data.stride+this.offset+e];return this.normalized&&(i=fe(i,this.array)),i}setComponent(t,e,i){return this.normalized&&(i=et(i,this.array)),this.data.array[t*this.data.stride+this.offset+e]=i,this}setX(t,e){return this.normalized&&(e=et(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=et(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=et(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=et(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=fe(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=fe(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=fe(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=fe(e,this.array)),e}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=et(e,this.array),i=et(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,s){return t=t*this.data.stride+this.offset,this.normalized&&(e=et(e,this.array),i=et(i,this.array),s=et(s,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=s,this}setXYZW(t,e,i,s,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=et(e,this.array),i=et(i,this.array),s=et(s,this.array),r=et(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=s,this.data.array[t+3]=r,this}clone(t){if(t===void 0){kr("InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)e.push(this.data.array[s+r])}return new Ue(new this.array.constructor(e),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new ns(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){kr("InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)e.push(this.data.array[s+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Gr extends Rs{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new hi(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let ci;const Ci=new g,ui=new g,di=new g,mi=new At,Ti=new At,jr=new Zt,as=new g,Bi=new g,hs=new g,Qr=new At,Zs=new At,Kr=new At;class sa extends Yt{constructor(t=new Gr){if(super(),this.isSprite=!0,this.type="Sprite",ci===void 0){ci=new Le;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new ia(e,5);ci.setIndex([0,1,2,0,2,3]),ci.setAttribute("position",new ns(i,3,0,!1)),ci.setAttribute("uv",new ns(i,2,3,!1))}this.geometry=ci,this.material=t,this.center=new At(.5,.5),this.count=1}raycast(t,e){t.camera===null&&Se('Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),ui.setFromMatrixScale(this.matrixWorld),jr.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),di.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&ui.multiplyScalar(-di.z);const i=this.material.rotation;let s,r;i!==0&&(r=Math.cos(i),s=Math.sin(i));const a=this.center;os(as.set(-.5,-.5,0),di,a,ui,s,r),os(Bi.set(.5,-.5,0),di,a,ui,s,r),os(hs.set(.5,.5,0),di,a,ui,s,r),Qr.set(0,0),Zs.set(1,0),Kr.set(1,1);let h=t.ray.intersectTriangle(as,Bi,hs,!1,Ci);if(h===null&&(os(Bi.set(-.5,.5,0),di,a,ui,s,r),Zs.set(0,1),h=t.ray.intersectTriangle(as,hs,Bi,!1,Ci),h===null))return;const o=t.ray.origin.distanceTo(Ci);o<t.near||o>t.far||e.push({distance:o,point:Ci.clone(),uv:Qt.getInterpolation(Ci,as,Bi,hs,Qr,Zs,Kr,new At),face:null,object:this})}copy(t,e){return super.copy(t,e),t.center!==void 0&&this.center.copy(t.center),this.material=t.material,this}}function os(n,t,e,i,s,r){mi.subVectors(n,e).addScalar(.5).multiply(i),s!==void 0?(Ti.x=r*mi.x-s*mi.y,Ti.y=s*mi.x+r*mi.y):Ti.copy(mi),n.copy(t),n.x+=Ti.x,n.y+=Ti.y,n.applyMatrix4(jr)}class tn extends Rs{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new hi(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const ls=new g,cs=new g,en=new Zt,ki=new Nr,us=new Cs,Xs=new g,sn=new g;class ra extends Yt{constructor(t=new Le,e=new tn){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.index===null){const e=t.attributes.position,i=[0];for(let s=1,r=e.count;s<r;s++)ls.fromBufferAttribute(e,s-1),cs.fromBufferAttribute(e,s),i[s]=i[s-1],i[s]+=ls.distanceTo(cs);t.setAttribute("lineDistance",new oi(i,1))}else Tt("Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const i=this.geometry,s=this.matrixWorld,r=t.params.Line.threshold,a=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),us.copy(i.boundingSphere),us.applyMatrix4(s),us.radius+=r,t.ray.intersectsSphere(us)===!1)return;en.copy(s).invert(),ki.copy(t.ray).applyMatrix4(en);const h=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=h*h,l=this.isLineSegments?2:1,c=i.index,m=i.attributes.position;if(c!==null){const f=Math.max(0,a.start),p=Math.min(c.count,a.start+a.count);for(let x=f,M=p-1;x<M;x+=l){const y=c.getX(x),S=c.getX(x+1),C=ds(this,t,ki,o,y,S,x);C&&e.push(C)}if(this.isLineLoop){const x=c.getX(p-1),M=c.getX(f),y=ds(this,t,ki,o,x,M,p-1);y&&e.push(y)}}else{const f=Math.max(0,a.start),p=Math.min(m.count,a.start+a.count);for(let x=f,M=p-1;x<M;x+=l){const y=ds(this,t,ki,o,x,x+1,x);y&&e.push(y)}if(this.isLineLoop){const x=ds(this,t,ki,o,p-1,f,p-1);x&&e.push(x)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const s=e[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=s.length;r<a;r++){const h=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[h]=r}}}}}function ds(n,t,e,i,s,r,a){const h=n.geometry.attributes.position;if(ls.fromBufferAttribute(h,s),cs.fromBufferAttribute(h,r),e.distanceSqToSegment(ls,cs,Xs,sn)>i)return;Xs.applyMatrix4(n.matrixWorld);const l=t.ray.origin.distanceTo(Xs);if(!(l<t.near||l>t.far))return{distance:l,point:sn.clone().applyMatrix4(n.matrixWorld),index:a,face:null,faceIndex:null,barycoord:null,object:n}}class rn extends Te{constructor(t,e,i,s,r,a,h,o,l){super(t,e,i,s,r,a,h,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Ys extends Le{constructor(t=1,e=1,i=1,s=32,r=1,a=!1,h=0,o=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:s,heightSegments:r,openEnded:a,thetaStart:h,thetaLength:o};const l=this;s=Math.floor(s),r=Math.floor(r);const c=[],d=[],m=[],f=[];let p=0;const x=[],M=i/2;let y=0;S(),a===!1&&(t>0&&C(!0),e>0&&C(!1)),this.setIndex(c),this.setAttribute("position",new oi(d,3)),this.setAttribute("normal",new oi(m,3)),this.setAttribute("uv",new oi(f,2));function S(){const w=new g,A=new g;let z=0;const v=(e-t)/i;for(let b=0;b<=r;b++){const F=[],D=b/r,B=D*(e-t)+t;for(let T=0;T<=s;T++){const E=T/s,N=E*o+h,W=Math.sin(N),I=Math.cos(N);A.x=B*W,A.y=-D*i+M,A.z=B*I,d.push(A.x,A.y,A.z),w.set(W,v,I).normalize(),m.push(w.x,w.y,w.z),f.push(E,1-D),F.push(p++)}x.push(F)}for(let b=0;b<s;b++)for(let F=0;F<r;F++){const D=x[F][b],B=x[F+1][b],T=x[F+1][b+1],E=x[F][b+1];(t>0||F!==0)&&(c.push(D,B,E),z+=3),(e>0||F!==r-1)&&(c.push(B,T,E),z+=3)}l.addGroup(y,z,0),y+=z}function C(w){const A=p,z=new At,v=new g;let b=0;const F=w===!0?t:e,D=w===!0?1:-1;for(let T=1;T<=s;T++)d.push(0,M*D,0),m.push(0,D,0),f.push(.5,.5),p++;const B=p;for(let T=0;T<=s;T++){const N=T/s*o+h,W=Math.cos(N),I=Math.sin(N);v.x=F*I,v.y=M*D,v.z=F*W,d.push(v.x,v.y,v.z),m.push(0,D,0),z.x=W*.5+.5,z.y=I*.5*D+.5,f.push(z.x,z.y),p++}for(let T=0;T<s;T++){const E=A+T,N=B+T;w===!0?c.push(N,N+1,E):c.push(N+1,N,E),b+=3}l.addGroup(y,b,w===!0?1:2),y+=b}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Ys(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class Js extends Ys{constructor(t=1,e=1,i=32,s=1,r=!1,a=0,h=Math.PI*2){super(0,t,e,i,s,r,a,h),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:s,openEnded:r,thetaStart:a,thetaLength:h}}static fromJSON(t){return new Js(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}const nn=new g;let ms,$s;class We extends Yt{constructor(t=new g(0,0,1),e=new g(0,0,0),i=1,s=16776960,r=i*.2,a=r*.2){super(),this.type="ArrowHelper",ms===void 0&&(ms=new Le,ms.setAttribute("position",new oi([0,0,0,0,1,0],3)),$s=new Js(.5,1,5,1),$s.translate(0,-.5,0)),this.position.copy(e),this.line=new ra(ms,new tn({color:s,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new ta($s,new Yr({color:s,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(i,r,a)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{nn.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(nn,e)}}setLength(t,e=t*.2,i=e*.2){this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(i,e,i),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:pr}})),typeof window<"u"&&(window.__THREE__?Tt("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=pr);class $t{x;y;z;constructor(t){this.x=t.x,this.y=t.y,this.z=t.z}static from(t,e,i){return new $t({x:t,y:e,z:i})}length(){return Math.sqrt(this.x**2+this.y**2+this.z**2)}normalize(){const t=this.length();return $t.from(this.x/t,this.y/t,this.z/t)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}subtract(t){return $t.from(this.x-t.x,this.y-t.y,this.z-t.z)}negate(){return $t.from(-this.x,-this.y,-this.z)}clamp(t,e){return $t.from(Math.max(t,Math.min(e,this.x)),Math.max(t,Math.min(e,this.y)),Math.max(t,Math.min(e,this.z)))}multiplyScalar(t){return $t.from(this.x*t,this.y*t,this.z*t)}add(t){return $t.from(this.x+t.x,this.y+t.y,this.z+t.z)}}class Mt{static SCALE_FACTOR=1/1e3;static EARTH_RADIUS_UNSCALED=6371.137;static EARTH_RADIUS_SCALED=this.km(this.EARTH_RADIUS_UNSCALED);static MOON_RADIUS_UNSCALED=1737.4;static MOON_RADIUS_SCALED=this.km(this.MOON_RADIUS_UNSCALED);static km(t){return t*Mt.SCALE_FACTOR}static AU(){return 1495978707e-1*Mt.SCALE_FACTOR}static AU_UNSCLAED(){return 1495978707e-1}static createWorldAxisHelper(t){const e=new g(0,0,0),i=new Fi;return i.add(new We(new g(1,0,0),e,t,16711680)),i.add(new We(new g(0,1,0),e,t,255)),i.add(new We(new g(0,0,1),e,t,65280)),i}static createLocal_X_AxisHelper(t){const e=new g(0,0,0),i=new Fi;return i.add(new We(new g(1,0,0),e,t,65535)),i}static createLocal_Y_AxisHelper(t){const e=new g(0,0,0),i=new Fi;return i.add(new We(new g(0,1,0),e,t,65535)),i}static createLocal_Z_AxisHelper(t){const e=new g(0,0,0),i=new Fi;return i.add(new We(new g(0,0,1),e,t,65535)),i}static createOriginArrow(t){const e=new g(0,0,0),i=new Fi;return i.add(new We(t,e,20,16777215)),i}static format(t,e=3){let i="";return i+="X: "+(t.x>0?"+":"")+t.x.toFixed(e)+" ",i+="Y: "+(t.y>0?"+":"")+t.y.toFixed(e)+" ",i+="Z: "+(t.z>0?"+":"")+t.z.toFixed(e),i}static formatQuaterion(t,e=3){let i="";return i+="X: "+(t.x>0?"+":"")+t.x.toFixed(e)+" ",i+="Y: "+(t.y>0?"+":"")+t.y.toFixed(e)+" ",i+="Z: "+(t.z>0?"+":"")+t.z.toFixed(e)+" ",i+="W: "+(t.w>0?"+":"")+t.w.toFixed(e)+" ",i}static geodeticToECEF(t,e,i){const s=dr(t),r=dr(e),h=Ui({latitude:s,longitude:r,height:i});return new g(h.x,h.z,-h.y)}static geodeticToECEFRad(t,e,i){const s=Ui({latitude:t,longitude:e,height:i});return new g(s.x,s.z,-s.y)}static makeCircleTexture(t=50/1e3){const e=document.createElement("canvas");e.width=e.height=t;const i=e.getContext("2d");return i.beginPath(),i.arc(t/2,t/2,t/2,0,Math.PI*2),i.fillStyle="white",i.fill(),new rn(e)}static getSunECIPosition(t){const e=Math.PI/180,s=(t.getTime()/864e5+24405875e-1-2451545)/36525,r=(280.46646+36000.76983*s)%360,a=(357.52911+35999.05029*s)%360,h=(1.914602-.004817*s-14e-6*s*s)*Math.sin(a*e)+(.019993-101e-6*s)*Math.sin(2*a*e)+289e-6*Math.sin(3*a*e),o=r+h,l=23.439291-.0130042*s,c=o*e,d=l*e,m=Math.cos(c),f=Math.cos(d)*Math.sin(c),p=Math.sin(d)*Math.sin(c);return new g(m,p,-f).multiplyScalar(Mt.AU())}static getSunECIunscaled(t){const e=Math.PI/180,s=(t.getTime()/864e5+24405875e-1-2451545)/36525,r=(280.46646+36000.76983*s)%360,a=(357.52911+35999.05029*s)%360,h=(1.914602-.004817*s-14e-6*s*s)*Math.sin(a*e)+(.019993-101e-6*s)*Math.sin(2*a*e)+289e-6*Math.sin(3*a*e),o=r+h,l=23.439291-.0130042*s,c=o*e,d=l*e,m=Math.cos(c),f=Math.cos(d)*Math.sin(c),p=Math.sin(d)*Math.sin(c);return{x:m*Mt.AU_UNSCLAED(),y:f*Mt.AU_UNSCLAED(),z:p*Mt.AU_UNSCLAED()}}static createTextSprite(t,e={}){const i=e.fontface||"monospace",s=e.fontsize||24,r=e.borderThickness||2,a=e.borderColor||{r:0,g:0,b:0,a:1},h=e.backgroundColor||{r:255,g:255,b:255,a:1},o=document.createElement("canvas"),l=o.getContext("2d");l.font=`${s}px ${i}`,l.fillStyle=`rgba(${h.r},${h.g},${h.b},${h.a})`,l.fillRect(0,0,o.width,o.height),l.strokeStyle=`rgba(${a.r},${a.g},${a.b},${a.a})`,l.lineWidth=r,l.strokeRect(0,0,o.width,o.height),l.fillStyle="rgba(0, 0, 0, 1.0)",l.fillText(t,r,s+r);const c=new rn(o),d=new Gr({map:c}),m=new sa(d);return m.scale.set(Mt.km(120),Mt.km(120),Mt.km(120)),m}static clog(t){console.log(t)}}const we={SUNLIT:16711935,UMBRA:8388608,PENUMBRA:13391104,SUNLIT_BELOW_HORIZON:10526880,DEFAULT:16777215};let Ei=-1,an=new Map;const Ve=new Map;self.onmessage=function(n){switch(n.data.type){case"youAreWorkerNumber":Ei=n.data.workerNum,console.log(`Worker[${Ei}]: SatSet/Worker number set`);break;case"sendOMMs":ha(n.data.omm);break;case"sgp4":na(n.data.jday);break;case"sgp4map":const t=n.data.jday,e=n.data.gmst,i=n.data.date,s=n.data.suneci,r=n.data.observer,a=n.data.checkAngle,h=n.data.hideInUmbra;aa(t,e,i,s,r,a,h);break;default:console.log(`Worker[${Ei}], unknown msg type: `+n.data);break}};function na(n){Ve.forEach((e,i)=>{const s=(n-e.jdsatepoch)*1440,r=ys(e,s);if(r){const a={type:"sgp4result",norad:i,posvel:r};self.postMessage(a)}});const t={type:"sgp4complete"};self.postMessage(t)}function aa(n,t,e,i,s=null,r,a){let h=0,o=0,l=Mt.getSunECIunscaled(e),c=[],d=new ArrayBuffer(Ve.size*3*Float32Array.BYTES_PER_ELEMENT),m=new ArrayBuffer(Ve.size*3*Float32Array.BYTES_PER_ELEMENT),f=new Float32Array(d),p=new ArrayBuffer(Ve.size*Float32Array.BYTES_PER_ELEMENT),x=new Float32Array(p),M=[],y=[],S=30,C=r!==null?r:3;Ve.forEach((A,z)=>{const v=wn(A,e);if(v){const b=vn(v.position,t);c.push(b);const F=v.position;switch(f[o+0]=F.x*Mt.SCALE_FACTOR,f[o+1]=F.z*Mt.SCALE_FACTOR,f[o+2]=-F.y*Mt.SCALE_FACTOR,oa(F,l)){case"SUNLIT":x[h]=we.SUNLIT;break;case"UMBRA":x[h]=we.UMBRA;break;case"PENUMBRA":x[h]=we.PENUMBRA;break;default:x[h]=we.DEFAULT;break}if(s!==null){const B=mr(F,t),T=fr(s,B);if(M[h]=T,x[h]==we.SUNLIT&&He(T.elevation)<0&&(x[h]=we.SUNLIT_BELOW_HORIZON),C!=null&&C<=180&&S>0&&T.elevation>0&&x[h]!=we.UMBRA){const E=Ui(s),N=An(E,t);la(F,l,N);{const W=mr(i,t),I=fr(s,W),G=He(I.elevation);if(G<-18&&G>-75){const Y=He(I.azimuth),V=He(T.azimuth);if(Math.abs(Y-V)<C){const U={x:F.x*Mt.SCALE_FACTOR,y:F.z*Mt.SCALE_FACTOR,z:-F.y*Mt.SCALE_FACTOR};y.push(U),S--}}}}else if(C!==null&&C>180&&He(T.elevation)>0&&x[h]===we.PENUMBRA){const E={x:F.x*Mt.SCALE_FACTOR,y:F.z*Mt.SCALE_FACTOR,z:-F.y*Mt.SCALE_FACTOR};y.push(E),S--}}else M[h]={azimuth:0,elevation:0,rangeSat:-1};x[h]===we.UMBRA&&a===!0&&(f[o+0]=0,f[o+1]=0,f[o+2]=0),o+=3,h++}});const w={type:"sgp4mapresult",rawgeo:d,color:m,ground:c,sunlit:p,lookangles:M,flareLines:y};self.postMessage(w)}function ha(n){an=n,an.forEach((i,s)=>{const r=bn(i);Ve.set(s,r)});const t={type:"sendOMMsAck"},e=Ve.size;console.log(`Worker[${Ei}] loaded ${e} OMM SatRec records`),self.postMessage(t),console.log(`Worker[${Ei}] ack'ing ${e} OMM SatRec records`)}function oa(n,t){const s=new $t(n),r=new $t(t),a=s.length(),h=r.subtract(n).length(),o=Math.asin(Math.min(1,6371/a)),l=Math.asin(Math.min(1,695700/h)),c=s.negate().normalize(),d=r.subtract(n).normalize(),m=Math.max(-1,Math.min(1,c.dot(d))),f=Math.acos(m);return f<=o-l?"UMBRA":f<o+l?"PENUMBRA":"SUNLIT"}function la(n,t,e){const i=new $t(n),s=new $t(t).subtract(i).normalize(),r=new $t(e).subtract(i).normalize(),a=s.dot(r),h=Math.max(-1,Math.min(1,a)),o=Math.acos(h);return He(o)}})();
